<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Contiki-Inga 3.x: cpu/avr/radio/rf230/radio.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Contiki-Inga 3.x
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_c433b04169c945a1c7f0848f853d4379.html">cpu</a></li><li class="navelem"><a class="el" href="dir_bcc0b3bc564a71f69a504b5999905a60.html">avr</a></li><li class="navelem"><a class="el" href="dir_6dbece4d6b8367f1720dbc6b0fdf37ed.html">radio</a></li><li class="navelem"><a class="el" href="dir_6c30141e77e2c79b999a5ddd876595aa.html">rf230</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">radio.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="a00667.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*   Copyright (c) 2008, Swedish Institute of Computer Science</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *  All rights reserved.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  Additional fixes for AVR contributed by:</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *      Colin O&#39;Flynn coflynn@newae.com</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *      Eric Gnoske egnoske@gmail.com</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *      Blake Leverett bleverett@gmail.com</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *      Mike Vidales mavida404@gmail.com</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *      Kevin Brown kbrown3@uccs.edu</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *      Nate Bohlmann nate@elfwerks.com</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *   All rights reserved.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *   modification, are permitted provided that the following conditions are met:</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *   * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *     notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> *   * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *     notice, this list of conditions and the following disclaimer in</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> *     the documentation and/or other materials provided with the</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *     distribution.</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *   * Neither the name of the copyright holders nor the names of</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> *     contributors may be used to endorse or promote products derived</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> *     from this software without specific prior written permission.</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> *  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> *  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> *  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> *  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> *  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> *  POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> *  \brief This module contains the radio driver code for the Atmel</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> *  AT86RF230, &#39;231, and &#39;212 chips.</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> *  \author Blake Leverett &lt;bleverett@gmail.com&gt;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> *          Mike Vidales &lt;mavida404@gmail.com&gt;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> *          Eric Gnoske &lt;egnoske@gmail.com&gt;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">/**  \addtogroup wireless</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"> * @{</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"> *  \defgroup radiorf230 RF230 interface</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment"> * @{</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"> */</span><span class="comment"></span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"> *  \file</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"> *  This file contains radio driver code.</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">/*============================ INCLUDE =======================================*/</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &lt;util/delay.h&gt;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a00189.html" title="This file contains radio driver code.">radio.h</a>&quot;</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a01118.html" title="This file contains low-level radio driver code.">hal.h</a>&quot;</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a00474.html" title="Header file for the Contiki process interface.">process.h</a>&quot;</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &quot;sicslowmac.h&quot;</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a00665.html" title="802.15.4 frame creation and parsing functions">frame.h</a>&quot;</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">/*============================ MACROS ========================================*/</span></div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="code" href="a01779.html#ga49000742b7bdcc563445f80ca9eb5fea">   77</a></span>&#160;<span class="preprocessor">#define RADIO_CCA_DONE_MASK     (1 &lt;&lt; 7) </span><span class="comment">/**&lt;  Mask used to check the CCA_DONE bit. */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="code" href="a01779.html#gad6f40027f61f63521388768c473dde45">   78</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define RADIO_CCA_IDLE_MASK     (1 &lt;&lt; 6) </span><span class="comment">/**&lt;  Mask used to check the CCA_STATUS bit. */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="code" href="a01779.html#ga86e1de74faf20f0824aeac0c65a70235">   80</a></span>&#160;<span class="preprocessor">#define RADIO_START_CCA (1) </span><span class="comment">/**&lt;  Value in the CCA_REQUEST subregister that initiate a cca. */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#define RADIO_TRANSMISSION_SUCCESS  (0)</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define RADIO_BUSY_CHANNEL          (3)</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define RADIO_MIN_IEEE_FRAME_LENGTH (5)</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor"></span><span class="comment">/*============================ TYPEDEFS ======================================*/</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">/** \brief  This enumeration defines the necessary timing information for the</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"> *          AT86RF230 radio transceiver. All times are in microseconds.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"> *          These constants are extracted from the datasheet.</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="code" href="a01779.html#ga7107f1e1a5e3b33325b5f7a489edb08d">   92</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span>{</div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dab843ffee3072fd1cb0582955224b6764">   93</a></span>&#160;    <a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dab843ffee3072fd1cb0582955224b6764" title="Transition time from VCC is applied to P_ON - most favorable case!">TIME_TO_ENTER_P_ON</a>               = 510, <span class="comment">/**&lt;  Transition time from VCC is applied to P_ON. */</span></div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dab9de5983d25a9b788432f79eeebbda1f">   94</a></span>&#160;    <a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dab9de5983d25a9b788432f79eeebbda1f" title="Transition time from P_ON to TRX_OFF.">TIME_P_ON_TO_TRX_OFF</a>             = 510, <span class="comment">/**&lt;  Transition time from P_ON to TRX_OFF. */</span></div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08da7067e6c59db93ac323c375140eff1c51">   95</a></span>&#160;    <a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08da7067e6c59db93ac323c375140eff1c51" title="Transition time from SLEEP to TRX_OFF.">TIME_SLEEP_TO_TRX_OFF</a>            = 880, <span class="comment">/**&lt;  Transition time from SLEEP to TRX_OFF. */</span></div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08da7987806807cc7ffc8afcafe42665af0f">   96</a></span>&#160;    <a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08da7987806807cc7ffc8afcafe42665af0f" title="Time to hold the RST pin low during reset.">TIME_RESET</a>                       = 6,   <span class="comment">/**&lt;  Time to hold the RST pin low during reset */</span></div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dacd603365652239fc2d4cef5c4f2dcf23">   97</a></span>&#160;    <a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dacd603365652239fc2d4cef5c4f2dcf23" title="Time it takes to do a ED measurement.">TIME_ED_MEASUREMENT</a>              = 140, <span class="comment">/**&lt;  Time it takes to do a ED measurement. */</span></div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08da40b984895797d7656266f48b724f2206">   98</a></span>&#160;    <a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08da40b984895797d7656266f48b724f2206" title="Time it takes to do a CCA.">TIME_CCA</a>                         = 140, <span class="comment">/**&lt;  Time it takes to do a CCA. */</span></div>
<div class="line"><a name="l00099"></a><span class="lineno"><a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dae5b568fca41fce82055b00269565b7ef">   99</a></span>&#160;    <a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dae5b568fca41fce82055b00269565b7ef" title="Maximum time it should take for the PLL to lock.">TIME_PLL_LOCK</a>                    = 150, <span class="comment">/**&lt;  Maximum time it should take for the PLL to lock. */</span></div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dacbada1dc573b954bad0184f6b111c02b">  100</a></span>&#160;    <a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dacbada1dc573b954bad0184f6b111c02b" title="Maximum time it should take to do the filter tuning.">TIME_FTN_TUNING</a>                  = 25,  <span class="comment">/**&lt;  Maximum time it should take to do the filter tuning. */</span></div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08da60b95807cc5d2690b9ee459c861c6a6c">  101</a></span>&#160;    <a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08da60b95807cc5d2690b9ee459c861c6a6c" title="Transition time from *_NOCLK to being awake.">TIME_NOCLK_TO_WAKE</a>               = 6,   <span class="comment">/**&lt;  Transition time from *_NOCLK to being awake. */</span></div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08daf50b81813c269484256d8d02b3751b4f">  102</a></span>&#160;    <a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08daf50b81813c269484256d8d02b3751b4f" title="Time it takes to execute the FORCE_TRX_OFF command.">TIME_CMD_FORCE_TRX_OFF</a>           = 1,    <span class="comment">/**&lt;  Time it takes to execute the FORCE_TRX_OFF command. */</span></div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dab69e9ed03883d6e427ea2027fb3daf13">  103</a></span>&#160;    <a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dab69e9ed03883d6e427ea2027fb3daf13" title="Transition time from TRX_OFF to: RX_ON, PLL_ON, TX_ARET_ON and RX_AACK_ON.">TIME_TRX_OFF_TO_PLL_ACTIVE</a>       = 180, <span class="comment">/**&lt;  Transition time from TRX_OFF to: RX_ON, PLL_ON, TX_ARET_ON and RX_AACK_ON. */</span></div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08daa68a9b1ecf13ab8095e32d86d35d416b">  104</a></span>&#160;    <a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08daa68a9b1ecf13ab8095e32d86d35d416b" title="Transition time from PLL active state to another.">TIME_STATE_TRANSITION_PLL_ACTIVE</a> = 1, <span class="comment">/**&lt;  Transition time from PLL active state to another. */</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;}<a class="code" href="a01779.html#ga7107f1e1a5e3b33325b5f7a489edb08d" title="This enumeration defines the necessary timing information for the AT86RF230 radio transceiver...">radio_trx_timing_t</a>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">/*============================ VARIABLES =====================================*/</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="keyword">static</span> <a class="code" href="a01776.html#ga3797f6d7a265fcfc4e68e1a5bf7a1a27" title="RX_START event handler callback type.">hal_rx_start_isr_event_handler_t</a> user_rx_event;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keyword">static</span> <a class="code" href="a01776.html#ga29b8c4b915c81726d8c390fe76171cce" title="RRX_END event handler callback type.">hal_trx_end_isr_event_handler_t</a> user_trx_end_event;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="keyword">static</span> radio_rx_callback rx_frame_callback;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="keyword">static</span> uint8_t rssi_val;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="keyword">static</span> uint8_t rx_mode;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;uint8_t rxMode = <a class="code" href="a00668.html#afddeaef97c7252f303f60355d79bf04c" title="Constant RX_AACK_ON for sub-register SR_TRX_STATUS.">RX_AACK_ON</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">/* See clock.c and httpd-cgi.c for RADIOSTATS code */</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">#define RADIOSTATS 0</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#if RADIOSTATS</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor"></span>uint8_t RF230_radio_on, RF230_rsigsi;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;uint16_t RF230_sendpackets,RF230_receivepackets,RF230_sendfail,RF230_receivefail;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="keyword">static</span> <a class="code" href="a00057.html" title="This struct defines the rx data container.">hal_rx_frame_t</a> rx_frame;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="keyword">static</span> parsed_frame_t parsed_frame;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">/*============================ PROTOTYPES ====================================*/</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="a01779.html#ga7c4b1fbd30174589d1a0660f30a543e3" title="This function checks if the radio transceiver is sleeping.">radio_is_sleeping</a>(<span class="keywordtype">void</span>);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> radio_rx_start_event(uint32_t <span class="keyword">const</span> isr_timestamp, uint8_t <span class="keyword">const</span> frame_length);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> radio_trx_end_event(uint32_t <span class="keyword">const</span> isr_timestamp);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">/** \brief  Initialize the Transceiver Access Toolbox and lower layers.</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"> *          If the initialization is successful the radio transceiver will be in</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"> *          TRX_OFF state.</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment"> *  \note  This function must be called prior to any of the other functions in</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment"> *         this file! Can be called from any transceiver state.</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"> *  \param cal_rc_osc If true, the radio&#39;s accurate clock is used to calibrate the</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"> *                    CPU&#39;s internal RC oscillator.</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"> *  \param rx_event Optional pointer to a user-defined function to be called on an</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"> *                  RX_START interrupt.  Use NULL for no handler.</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment"> *  \param trx_end_event Optional pointer to a user-defined function to be called on an</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"> *                  TRX_END interrupt.  Use NULL for no handler.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment"> *  \param rx_callback Optional pointer to a user-defined function that receives</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment"> *         a frame from the radio one byte at a time.  If the index parameter to</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment"> *         this callback is 0xff, then the function should reset its state and prepare</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment"> *         for a frame from the radio, with one call per byte.</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment"> *  \retval RADIO_SUCCESS     The radio transceiver was successfully initialized</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment"> *                          and put into the TRX_OFF state.</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment"> *  \retval RADIO_UNSUPPORTED_DEVICE  The connected device is not an Atmel</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment"> *                                  AT86RF230 radio transceiver.</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment"> *  \retval RADIO_TIMED_OUT   The radio transceiver was not able to initialize and</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment"> *                          enter TRX_OFF state within the specified time.</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l00160"></a><span class="lineno"><a class="code" href="a01779.html#ga4e9853fe6b340a6f000cdfd1134d7597">  160</a></span>&#160;<a class="code" href="a01779.html#ga4e9853fe6b340a6f000cdfd1134d7597" title="Initialize the Transceiver Access Toolbox and lower layers.">radio_init</a>(<span class="keywordtype">bool</span> cal_rc_osc,</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;           <a class="code" href="a01776.html#ga3797f6d7a265fcfc4e68e1a5bf7a1a27" title="RX_START event handler callback type.">hal_rx_start_isr_event_handler_t</a> rx_event,</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;           <a class="code" href="a01776.html#ga29b8c4b915c81726d8c390fe76171cce" title="RRX_END event handler callback type.">hal_trx_end_isr_event_handler_t</a> trx_end_event,</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;           radio_rx_callback rx_callback)</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;{</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a> init_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    delay_us(<a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dab843ffee3072fd1cb0582955224b6764" title="Transition time from VCC is applied to P_ON - most favorable case!">TIME_TO_ENTER_P_ON</a>);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">/*  calibrate oscillator */</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span> (cal_rc_osc){</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <a class="code" href="a01779.html#gaaa84b1c0e7ec53220e17cabca6832b52" title="Calibrate the internal RC oscillator.">calibrate_rc_osc_32k</a>();</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">/* Initialize Hardware Abstraction Layer. */</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="a01776.html#gaf5ea8985a12feedc3ac25fbb50712183" title="This function initializes the Hardware Abstraction Layer.">hal_init</a>();</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="a01779.html#ga54684d521cdfbb1f049443846c73f10f" title="This function will reset all the registers and the state machine of the radio transceiver.">radio_reset_trx</a>(); <span class="comment">/* Do HW reset of radio transeiver. */</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">/* Force transition to TRX_OFF. */</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a8d912618842812f37fc46356eff73c93" title="Access parameters for sub-register TRX_CMD in register RG_TRX_STATE.">SR_TRX_CMD</a>, <a class="code" href="a00668.html#a8ecc63755abb125691b00426cba7fe41" title="Constant CMD_FORCE_TRX_OFF for sub-register SR_TRX_CMD.">CMD_FORCE_TRX_OFF</a>);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    delay_us(<a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dab9de5983d25a9b788432f79eeebbda1f" title="Transition time from P_ON to TRX_OFF.">TIME_P_ON_TO_TRX_OFF</a>); <span class="comment">/* Wait for the transition to be complete. */</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga8e301ea5e85cf022a857a892f98b4a62" title="This function return the Radio Transceivers current state.">radio_get_trx_state</a>() != <a class="code" href="a00668.html#ad9aff3d987888b9d1bcb9fc12d2c996e" title="Constant TRX_OFF for sub-register SR_TRX_STATUS.">TRX_OFF</a>){</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        init_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ac1e26b7c1be4cb9607efaa1967061bd7" title="The requested service timed out.">RADIO_TIMED_OUT</a>;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="comment">/* Read Version Number */</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        uint8_t version_number = <a class="code" href="a01776.html#gaf3c702dd022b52907dc882a346a16819" title="This function reads data from one of the radio transceiver&#39;s registers.">hal_register_read</a>(<a class="code" href="a00668.html#ac1888aaec44899f2a3d7856b757533e8" title="Offset for register VERSION_NUM.">RG_VERSION_NUM</a>);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keywordflow">if</span> ((version_number != RF230_REVA) &amp;&amp; (version_number != RF230_REVB))</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            init_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73a053f75192c9eeb244880ef68d103246d" title="The connected device is not an Atmel AT86RF230.">RADIO_UNSUPPORTED_DEVICE</a>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="a01776.html#gaf3c702dd022b52907dc882a346a16819" title="This function reads data from one of the radio transceiver&#39;s registers.">hal_register_read</a>(<a class="code" href="a00668.html#a3514dae6641c832c5223c74151544f17" title="Offset for register MAN_ID_0.">RG_MAN_ID_0</a>) != SUPPORTED_MANUFACTURER_ID)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                init_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73a053f75192c9eeb244880ef68d103246d" title="The connected device is not an Atmel AT86RF230.">RADIO_UNSUPPORTED_DEVICE</a>;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                <a class="code" href="a01776.html#ga733238be74ad06adfc1720e56427a447" title="This function writes a new value to one of the radio transceiver&#39;s registers.">hal_register_write</a>(<a class="code" href="a00668.html#a905b648376932649f2af990f20a03df6" title="Offset for register IRQ_MASK.">RG_IRQ_MASK</a>, RF230_SUPPORTED_INTERRUPT_MASK);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="preprocessor">#if RADIOSTATS</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="preprocessor"></span>        RF230_radio_on = 1;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="preprocessor"></span>    }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">/*  set callbacks for events.  Save user&#39;s rx_event, which we will */</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">/*  call from radio_rx_start_event().  Same with trx_end */</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    user_rx_event = rx_event;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    user_trx_end_event = trx_end_event;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <a class="code" href="a01776.html#gabe75f8512838143045c3e54598edf199" title="This function is used to set new RX_START event handler, overriding old handler reference.">hal_set_rx_start_event_handler</a>(radio_rx_start_event);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <a class="code" href="a01776.html#gabc5b49e953f6d324cb3b4efe6a86d431" title="This function is used to set new TRX_END event handler, overriding old handler reference.">hal_set_trx_end_event_handler</a>(radio_trx_end_event);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    rx_frame_callback = rx_callback;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">return</span> init_status;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;}</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">/*---------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;uint8_t *</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;radio_frame_data(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;{</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordflow">return</span> rx_frame.<a class="code" href="a00057.html#a5d23f15b3b8e39774c9a54ee00b544d2" title="Actual frame data.">data</a>;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;}</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;uint8_t</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;radio_frame_length(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;{</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordflow">return</span> rx_frame.<a class="code" href="a00057.html#a5bd2554c7ea38ac94a3712af366711c7" title="Length of frame.">length</a>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;}</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">/*---------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;radio_rx_start_event(uint32_t <span class="keyword">const</span> isr_timestamp, uint8_t <span class="keyword">const</span> frame_length)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;{</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">/*  save away RSSI */</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    rssi_val =  <a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>( <a class="code" href="a00668.html#ae4a0fbc6bd43fdcb0272429f5b6edb86" title="Access parameters for sub-register RSSI in register RG_PHY_RSSI.">SR_RSSI</a> );</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">/*  call user&#39;s rx_start event handler */</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">if</span> (user_rx_event)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        user_rx_event(isr_timestamp, frame_length);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">/*---------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;uint8_t</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;radio_get_saved_rssi_value(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;{</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">return</span> rssi_val;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;}</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">/*---------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;radio_trx_end_event(uint32_t <span class="keyword">const</span> isr_timestamp)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;{</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keyword">volatile</span> uint8_t status;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">/*  call user&#39;s trx_end event handler */</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">if</span> (user_trx_end_event){</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        user_trx_end_event(isr_timestamp);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span> (rx_mode){</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="comment">/* radio has received frame, store it away */</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="preprocessor">#if RADIOSTATS</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="preprocessor"></span>        RF230_rsigsi=rssi_val;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        RF230_receivepackets++;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="preprocessor"></span>        parsed_frame.time = isr_timestamp;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        parsed_frame.rssi = rssi_val;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <a class="code" href="a01776.html#ga4513cc1f29bd22aa10ed778f5a6d4870" title="Transfer a frame from the radio transceiver to a RAM buffer.">hal_frame_read</a>(&amp;rx_frame, <a class="code" href="a01885.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="The null pointer.">NULL</a>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <a class="code" href="a01778.html#ga5b6553d68f25a7a9e4884b1f9384a07d" title="Parses an input frame.">rx_frame_parse</a>(&amp;rx_frame, &amp;parsed_frame);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        }</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">if</span> (!rx_mode){</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="comment">/*  Put radio back into receive mode. */</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <a class="code" href="a01779.html#ga06b43a13b2efd1a4e0c1b9ae7a204c81" title="This function will change the current state of the radio transceiver&#39;s internal state machine...">radio_set_trx_state</a>(<a class="code" href="a00668.html#ad9aff3d987888b9d1bcb9fc12d2c996e" title="Constant TRX_OFF for sub-register SR_TRX_STATUS.">TRX_OFF</a>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <a class="code" href="a01779.html#ga06b43a13b2efd1a4e0c1b9ae7a204c81" title="This function will change the current state of the radio transceiver&#39;s internal state machine...">radio_set_trx_state</a>(rxMode);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="comment">/*  transmit mode, put end-of-transmit event in queue */</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        event_object_t event;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="keyword">event</span>.event = 0;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="keyword">event</span>.data = 0;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        status = <a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#a4692d9ea2770ff145d1c35c513cbf1d6" title="Access parameters for sub-register TRAC_STATUS in register RG_TRX_STATE.">SR_TRAC_STATUS</a>);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="keywordflow">switch</span>(status){</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordflow">case</span> TRAC_SUCCESS:</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keywordflow">case</span> TRAC_SUCCESS_DATA_PENDING:</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <span class="keyword">event</span>.event = MAC_EVENT_ACK;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">case</span> TRAC_NO_ACK:</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordflow">case</span> TRAC_CHANNEL_ACCESS_FAILURE:</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="keyword">event</span>.event = MAC_EVENT_NACK;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="preprocessor">#if RADIOSTATS</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="preprocessor"></span>        RF230_sendfail++;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="preprocessor"></span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">case</span> TRAC_SUCCESS_WAIT_FOR_ACK:</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="comment">/*  should only happen in RX mode */</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">case</span> TRAC_INVALID:</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="comment">/*  should never happen here */</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="preprocessor">#if RADIOSTATS</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="preprocessor"></span>            RF230_sendfail++;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="preprocessor"></span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">if</span> (event.event)</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            <a class="code" href="a00359.html#a546b1497ed4c233b1bbfcc34c0b386be" title="Puts an event into the queue of events.">mac_put_event</a>(&amp;event);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <a class="code" href="a01676.html#gab9d3fbbf6273dd3f0da62887c4433d39" title="Post an asynchronous event.">process_post</a>(&amp;mac_process, event.event, event.data);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;}</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">/** \brief  This function will return the channel used by the radio transceiver.</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment"> *  \return Current channel, 11 to 26.</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;uint8_t</div>
<div class="line"><a name="l00313"></a><span class="lineno"><a class="code" href="a01779.html#ga918bfcb229236b545ff18ffbabef1288">  313</a></span>&#160;<a class="code" href="a01779.html#ga918bfcb229236b545ff18ffbabef1288" title="This function will return the channel used by the radio transceiver.">radio_get_operating_channel</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;{</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#a4b9bff87f5d63f845e3fad83286624db" title="Access parameters for sub-register CHANNEL in register RG_PHY_CC_CCA.">SR_CHANNEL</a>);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;}</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">/** \brief This function will change the operating channel.</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment"> *  \param  channel New channel to operate on. Must be between 11 and 26.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment"> *  \retval RADIO_SUCCESS New channel set.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment"> *  \retval RADIO_WRONG_STATE Transceiver is in a state where the channel cannot</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment"> *                          be changed (SLEEP).</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment"> *  \retval RADIO_INVALID_ARGUMENT Channel argument is out of bounds.</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment"> *  \retval RADIO_TIMED_OUT The PLL did not lock within the specified time.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l00329"></a><span class="lineno"><a class="code" href="a01779.html#gaa16555040f23e644c73eb0204dbb6204">  329</a></span>&#160;<a class="code" href="a01779.html#gaa16555040f23e644c73eb0204dbb6204" title="This function will change the operating channel.">radio_set_operating_channel</a>(uint8_t channel)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;{</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">/*Do function parameter and state check.*/</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">if</span> ((channel &lt; RF230_MIN_CHANNEL) ||</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        (channel &gt; RF230_MAX_CHANNEL)){</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73a9dc11f55b8f5a813e72002eb36710389" title="One or more of the supplied function arguments are invalid.">RADIO_INVALID_ARGUMENT</a>;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    }</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga7c4b1fbd30174589d1a0660f30a543e3" title="This function checks if the radio transceiver is sleeping.">radio_is_sleeping</a>() == <span class="keyword">true</span>){</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae2cba4f4b63e5ff3c6e3a4bbbb1358e5" title="The end-user tried to do an invalid state transition.">RADIO_WRONG_STATE</a>;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga918bfcb229236b545ff18ffbabef1288" title="This function will return the channel used by the radio transceiver.">radio_get_operating_channel</a>() == channel){</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    }</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="comment">/*Set new operating channel.*/</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a4b9bff87f5d63f845e3fad83286624db" title="Access parameters for sub-register CHANNEL in register RG_PHY_CC_CCA.">SR_CHANNEL</a>, channel);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment">/* Read current state and wait for the PLL_LOCK interrupt if the */</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">/* radio transceiver is in either RX_ON or PLL_ON. */</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    uint8_t trx_state = <a class="code" href="a01779.html#ga8e301ea5e85cf022a857a892f98b4a62" title="This function return the Radio Transceivers current state.">radio_get_trx_state</a>();</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">if</span> ((trx_state == <a class="code" href="a00668.html#a359db88bcffa6b39bdb64ec00ec3a1ae" title="Constant RX_ON for sub-register SR_TRX_STATUS.">RX_ON</a>) ||</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        (trx_state == <a class="code" href="a00668.html#a77a32ac338596fe95ea09d7603d7c295" title="Constant PLL_ON for sub-register SR_TRX_STATUS.">PLL_ON</a>)){</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        delay_us(<a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dae5b568fca41fce82055b00269565b7ef" title="Maximum time it should take for the PLL to lock.">TIME_PLL_LOCK</a>);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a> channel_set_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ac1e26b7c1be4cb9607efaa1967061bd7" title="The requested service timed out.">RADIO_TIMED_OUT</a>;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">/* Check that the channel was set properly. */</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga918bfcb229236b545ff18ffbabef1288" title="This function will return the channel used by the radio transceiver.">radio_get_operating_channel</a>() == channel){</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        channel_set_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">return</span> channel_set_status;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;}</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">/** \brief This function will read and return the output power level.</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment"> *  \returns 0 to 15 Current output power in &quot;TX power settings&quot; as defined in</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment"> *          the radio transceiver&#39;s datasheet</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;uint8_t</div>
<div class="line"><a name="l00374"></a><span class="lineno"><a class="code" href="a01779.html#ga424fe6e9473de76b6c8b8ed206b00ae1">  374</a></span>&#160;<a class="code" href="a01779.html#ga424fe6e9473de76b6c8b8ed206b00ae1" title="This function will read and return the output power level.">radio_get_tx_power_level</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;{</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#a34ec89db5926c2c2348dbc587629a9e8" title="Access parameters for sub-register TX_PWR in register RG_PHY_TX_PWR.">SR_TX_PWR</a>);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;}</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">/** \brief This function will change the output power level.</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment"> *  \param  power_level New output power level in the &quot;TX power settings&quot;</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment"> *                      as defined in the radio transceiver&#39;s datasheet.</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment"> *  \retval RADIO_SUCCESS New output power set successfully.</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment"> *  \retval RADIO_INVALID_ARGUMENT The supplied function argument is out of bounds.</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment"> *  \retval RADIO_WRONG_STATE It is not possible to change the TX power when the</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment"> *                          device is sleeping.</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l00391"></a><span class="lineno"><a class="code" href="a01779.html#ga12275c916e1d9def7ea31d2cc3a80c65">  391</a></span>&#160;<a class="code" href="a01779.html#ga12275c916e1d9def7ea31d2cc3a80c65" title="This function will change the output power level.">radio_set_tx_power_level</a>(uint8_t power_level)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;{</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="comment">/*Check function parameter and state.*/</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">if</span> (power_level &gt; TX_PWR_17_2DBM){</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73a9dc11f55b8f5a813e72002eb36710389" title="One or more of the supplied function arguments are invalid.">RADIO_INVALID_ARGUMENT</a>;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga7c4b1fbd30174589d1a0660f30a543e3" title="This function checks if the radio transceiver is sleeping.">radio_is_sleeping</a>() == <span class="keyword">true</span>){</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae2cba4f4b63e5ff3c6e3a4bbbb1358e5" title="The end-user tried to do an invalid state transition.">RADIO_WRONG_STATE</a>;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="comment">/*Set new power level*/</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a34ec89db5926c2c2348dbc587629a9e8" title="Access parameters for sub-register TX_PWR in register RG_PHY_TX_PWR.">SR_TX_PWR</a>, power_level);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;}</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">/** \brief This function returns the current CCA mode used.</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment"> *  \return CCA mode currently used, 0 to 3.</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;uint8_t</div>
<div class="line"><a name="l00415"></a><span class="lineno"><a class="code" href="a01779.html#ga6cae5bc6e98ef4a519dc5664492a4ffb">  415</a></span>&#160;<a class="code" href="a01779.html#ga6cae5bc6e98ef4a519dc5664492a4ffb" title="This function returns the current CCA mode used.">radio_get_cca_mode</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;{</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#a5f1683f4ba650a0737bf0a4cce54da51" title="Access parameters for sub-register CCA_MODE in register RG_PHY_CC_CCA.">SR_CCA_MODE</a>);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;}</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">/** \brief This function returns the current ED threshold used by the CCA algorithm.</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment"> *  \return Current ED threshold, 0 to 15.</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;uint8_t</div>
<div class="line"><a name="l00426"></a><span class="lineno"><a class="code" href="a01779.html#ga04a68fa37dfc2849ae68ad7380c4beb3">  426</a></span>&#160;<a class="code" href="a01779.html#ga04a68fa37dfc2849ae68ad7380c4beb3" title="This function returns the current ED threshold used by the CCA algorithm.">radio_get_ed_threshold</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;{</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#a5d49fade58407955545f861fc65078b9" title="Access parameters for sub-register CCA_ED_THRES in register RG_CCA_THRES.">SR_CCA_ED_THRES</a>);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;}</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">/** \brief This function will configure the Clear Channel Assessment algorithm.</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment"> *  \param  mode Three modes are available: Energy above threshold, carrier</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment"> *               sense only and carrier sense with energy above threshold.</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment"> *  \param  ed_threshold Above this energy threshold the channel is assumed to be</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment"> *                      busy. The threshold is given in positive dBm values.</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"> *                      Ex. -91 dBm gives a csThreshold of 91. Value range for</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment"> *                      the variable is [61 to 91]. Only valid for the CCA_ED</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment"> *                      and CCA_CARRIER_SENSE_ED modes.</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment"> *  \retval RADIO_SUCCESS Mode and its parameters successfully changed.</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment"> *  \retval RADIO_WRONG_STATE This function cannot be called in the SLEEP state.</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment"> *  \retval RADIO_INVALID_ARGUMENT If one of the three function arguments are out</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment"> *                               of bounds.</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l00448"></a><span class="lineno"><a class="code" href="a01779.html#gae6fe9892339b76a7a586fe5d613ab0eb">  448</a></span>&#160;<a class="code" href="a01779.html#gae6fe9892339b76a7a586fe5d613ab0eb" title="This function will configure the Clear Channel Assessment algorithm.">radio_set_cca_mode</a>(uint8_t mode, uint8_t ed_threshold)</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;{</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="comment">/*Check function parameters and state.*/</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordflow">if</span> ((mode != <a class="code" href="a01779.html#ggab71d6a3c66ce80ec4c231e5111bf923daa9df48be09d8bf0586bca022e64d06a9" title="Use energy detection above threshold mode.">CCA_ED</a>) &amp;&amp;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        (mode != <a class="code" href="a01779.html#ggab71d6a3c66ce80ec4c231e5111bf923daeae3badd37859833ee1708f4d251928d" title="Use carrier sense mode.">CCA_CARRIER_SENSE</a>) &amp;&amp;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        (mode != <a class="code" href="a01779.html#ggab71d6a3c66ce80ec4c231e5111bf923daf274aea74cda340a393d7ba839dd04f7" title="Use a combination of both energy detection and carrier sense.">CCA_CARRIER_SENSE_WITH_ED</a>)){</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73a9dc11f55b8f5a813e72002eb36710389" title="One or more of the supplied function arguments are invalid.">RADIO_INVALID_ARGUMENT</a>;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment">/* Ensure that the ED threshold is within bounds. */</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">if</span> (ed_threshold &gt; RF230_MAX_ED_THRESHOLD){</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73a9dc11f55b8f5a813e72002eb36710389" title="One or more of the supplied function arguments are invalid.">RADIO_INVALID_ARGUMENT</a>;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="comment">/* Ensure that the radio transceiver is not sleeping. */</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga7c4b1fbd30174589d1a0660f30a543e3" title="This function checks if the radio transceiver is sleeping.">radio_is_sleeping</a>() == <span class="keyword">true</span>){</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae2cba4f4b63e5ff3c6e3a4bbbb1358e5" title="The end-user tried to do an invalid state transition.">RADIO_WRONG_STATE</a>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    }</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="comment">/*Change cca mode and ed threshold.*/</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a5f1683f4ba650a0737bf0a4cce54da51" title="Access parameters for sub-register CCA_MODE in register RG_PHY_CC_CCA.">SR_CCA_MODE</a>, mode);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a5d49fade58407955545f861fc65078b9" title="Access parameters for sub-register CCA_ED_THRES in register RG_CCA_THRES.">SR_CCA_ED_THRES</a>, ed_threshold);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;}</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">/** \brief This function returns the Received Signal Strength Indication.</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment"> *  \note This function should only be called from the: RX_ON and BUSY_RX. This</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment"> *        can be ensured by reading the current state of the radio transceiver</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment"> *        before executing this function!</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment"> *  \param rssi Pointer to memory location where RSSI value should be written.</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment"> *  \retval RADIO_SUCCESS The RSSI measurement was successful.</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment"> *  \retval RADIO_WRONG_STATE The radio transceiver is not in RX_ON or BUSY_RX.</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l00485"></a><span class="lineno"><a class="code" href="a01779.html#gab67dc7befec87decb8f36ef63eef3b77">  485</a></span>&#160;<a class="code" href="a01779.html#gab67dc7befec87decb8f36ef63eef3b77" title="This function returns the Received Signal Strength Indication.">radio_get_rssi_value</a>(uint8_t *rssi)</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;{</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    uint8_t current_state = <a class="code" href="a01779.html#ga8e301ea5e85cf022a857a892f98b4a62" title="This function return the Radio Transceivers current state.">radio_get_trx_state</a>();</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a> retval = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae2cba4f4b63e5ff3c6e3a4bbbb1358e5" title="The end-user tried to do an invalid state transition.">RADIO_WRONG_STATE</a>;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="comment">/*The RSSI measurement should only be done in RX_ON or BUSY_RX.*/</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">if</span> ((current_state == <a class="code" href="a00668.html#a359db88bcffa6b39bdb64ec00ec3a1ae" title="Constant RX_ON for sub-register SR_TRX_STATUS.">RX_ON</a>) ||</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        (current_state == <a class="code" href="a00668.html#a9486d08d26658473840dd55ef9d59783" title="Constant BUSY_RX for sub-register SR_TRX_STATUS.">BUSY_RX</a>)){</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        *rssi = <a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#ae4a0fbc6bd43fdcb0272429f5b6edb86" title="Access parameters for sub-register RSSI in register RG_PHY_RSSI.">SR_RSSI</a>);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        retval = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    }</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordflow">return</span> retval;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;}</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">/** \brief This function returns the current threshold volatge used by the</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment"> *         battery monitor (BATMON_VTH).</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment"> *  \note This function can not be called from P_ON or SLEEP. This is ensured</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment"> *        by reading the device state before calling this function.</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment"> *  \return Current threshold voltage, 0 to 15.</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;uint8_t</div>
<div class="line"><a name="l00511"></a><span class="lineno"><a class="code" href="a01779.html#ga91158b7dac9c5836ab460fca224e760d">  511</a></span>&#160;<a class="code" href="a01779.html#ga91158b7dac9c5836ab460fca224e760d" title="This function returns the current threshold volatge used by the battery monitor (BATMON_VTH).">radio_batmon_get_voltage_threshold</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;{</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#af4d8678ff08d67835ed9fde2e063e524" title="Access parameters for sub-register BATMON_VTH in register RG_BATMON.">SR_BATMON_VTH</a>);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;}</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">/** \brief This function returns if high or low voltage range is used.</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment"> *  \note This function can not be called from P_ON or SLEEP. This is ensured</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment"> *        by reading the device state before calling this function.</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment"> *  \retval 0 Low voltage range selected.</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment"> *  \retval 1 High voltage range selected.</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;uint8_t</div>
<div class="line"><a name="l00526"></a><span class="lineno"><a class="code" href="a01779.html#gaf516804b4ecd978c1cd1ef91eaaebde4">  526</a></span>&#160;<a class="code" href="a01779.html#gaf516804b4ecd978c1cd1ef91eaaebde4" title="This function returns if high or low voltage range is used.">radio_batmon_get_voltage_range</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;{</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#aaade16ed1ba624efbf6a71cb66af9d0f" title="Access parameters for sub-register BATMON_HR in register RG_BATMON.">SR_BATMON_HR</a>);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;}</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">/** \brief This function is used to configure the battery monitor module</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment"> *  \param range True means high voltage range and false low voltage range.</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment"> *  \param voltage_threshold The datasheet defines 16 voltage levels for both</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment"> *                          low and high range.</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment"> *  \retval RADIO_SUCCESS Battery monitor configured</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment"> *  \retval RADIO_WRONG_STATE The device is sleeping.</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment"> *  \retval RADIO_INVALID_ARGUMENT The voltage_threshold parameter is out of</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment"> *                               bounds (Not within [0 - 15]).</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l00543"></a><span class="lineno"><a class="code" href="a01779.html#ga6ddd12093e883498434a1f0502afd223">  543</a></span>&#160;<a class="code" href="a01779.html#ga6ddd12093e883498434a1f0502afd223" title="This function is used to configure the battery monitor module.">radio_batmon_configure</a>(<span class="keywordtype">bool</span> range, uint8_t voltage_threshold)</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;{</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="comment">/*Check function parameters and state.*/</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordflow">if</span> (voltage_threshold &gt; BATTERY_MONITOR_HIGHEST_VOLTAGE){</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73a9dc11f55b8f5a813e72002eb36710389" title="One or more of the supplied function arguments are invalid.">RADIO_INVALID_ARGUMENT</a>;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    }</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga7c4b1fbd30174589d1a0660f30a543e3" title="This function checks if the radio transceiver is sleeping.">radio_is_sleeping</a>() == <span class="keyword">true</span>){</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae2cba4f4b63e5ff3c6e3a4bbbb1358e5" title="The end-user tried to do an invalid state transition.">RADIO_WRONG_STATE</a>;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="comment">/*Write new voltage range and voltage level.*/</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">if</span> (range == <span class="keyword">true</span>){</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#aaade16ed1ba624efbf6a71cb66af9d0f" title="Access parameters for sub-register BATMON_HR in register RG_BATMON.">SR_BATMON_HR</a>, BATTERY_MONITOR_HIGH_VOLTAGE);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#aaade16ed1ba624efbf6a71cb66af9d0f" title="Access parameters for sub-register BATMON_HR in register RG_BATMON.">SR_BATMON_HR</a>, BATTERY_MONITOR_LOW_VOLTAGE);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#af4d8678ff08d67835ed9fde2e063e524" title="Access parameters for sub-register BATMON_VTH in register RG_BATMON.">SR_BATMON_VTH</a>, voltage_threshold);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;}</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">/** \brief This function returns the status of the Battery Monitor module.</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment"> *  \note This function can not be called from P_ON or SLEEP. This is ensured</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment"> *        by reading the device state before calling this function.</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment"> *  \retval RADIO_BAT_LOW Battery voltage is below the programmed threshold.</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment"> *  \retval RADIO_BAT_OK Battery voltage is above the programmed threshold.</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l00577"></a><span class="lineno"><a class="code" href="a01779.html#gad33630ec5deaced83d660b18ee8a9a78">  577</a></span>&#160;<a class="code" href="a01779.html#gad33630ec5deaced83d660b18ee8a9a78" title="This function returns the status of the Battery Monitor module.">radio_batmon_get_status</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;{</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a> batmon_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73adba268aded546c8ee6aa90fb1b457d09" title="Measured battery voltage is lower than voltage threshold.">RADIO_BAT_LOW</a>;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#acff72bdcbf66f9ef80b51797328f04b4" title="Access parameters for sub-register BATMON_OK in register RG_BATMON.">SR_BATMON_OK</a>) !=</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        BATTERY_MONITOR_VOLTAGE_UNDER_THRESHOLD){</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        batmon_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73a12f567282c526bee93379f8a69a60fb3" title="Measured battery voltage is above the voltage threshold.">RADIO_BAT_OK</a>;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    }</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">return</span> batmon_status;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;}</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">/** \brief This function returns the current clock setting for the CLKM pin.</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment"> *  \retval CLKM_DISABLED CLKM pin is disabled.</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment"> *  \retval CLKM_1MHZ CLKM pin is prescaled to 1 MHz.</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment"> *  \retval CLKM_2MHZ CLKM pin is prescaled to 2 MHz.</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment"> *  \retval CLKM_4MHZ CLKM pin is prescaled to 4 MHz.</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment"> *  \retval CLKM_8MHZ CLKM pin is prescaled to 8 MHz.</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment"> *  \retval CLKM_16MHZ CLKM pin is not prescaled. Output is 16 MHz.</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;uint8_t</div>
<div class="line"><a name="l00601"></a><span class="lineno"><a class="code" href="a01779.html#gafd5fa5fa5a7629d3b940552afbe5c142">  601</a></span>&#160;<a class="code" href="a01779.html#gafd5fa5fa5a7629d3b940552afbe5c142" title="This function returns the current clock setting for the CLKM pin.">radio_get_clock_speed</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;{</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#ac108f260911d536daba845f79a0c7eff" title="Access parameters for sub-register CLKM_CTRL in register RG_TRX_CTRL_0.">SR_CLKM_CTRL</a>);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;}</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">/** \brief This function changes the prescaler on the CLKM pin.</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment"> *  \param direct   This boolean variable is used to determine if the frequency</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment"> *                  of the CLKM pin shall be changed directly or not. If direct</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment"> *                  equals true, the frequency will be changed directly. This is</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment"> *                  fine if the CLKM signal is used to drive a timer etc. on the</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment"> *                  connected microcontroller. However, the CLKM signal can also</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment"> *                  be used to clock the microcontroller itself. In this situation</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment"> *                  it is possible to change the CLKM frequency indirectly</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment"> *                  (direct == false). When the direct argument equlas false, the</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment"> *                  CLKM frequency will be changed first after the radio transceiver</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment"> *                  has been taken to SLEEP and awaken again.</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment"> *  \param clock_speed This parameter can be one of the following constants:</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment"> *                     CLKM_DISABLED, CLKM_1MHZ, CLKM_2MHZ, CLKM_4MHZ, CLKM_8MHZ</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment"> *                     or CLKM_16MHZ.</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment"> *  \retval RADIO_SUCCESS Clock speed updated. New state is TRX_OFF.</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment"> *  \retval RADIO_INVALID_ARGUMENT Requested clock speed is out of bounds.</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l00627"></a><span class="lineno"><a class="code" href="a01779.html#gaed81adcaca247848a64a7b612b1df5d5">  627</a></span>&#160;<a class="code" href="a01779.html#gaed81adcaca247848a64a7b612b1df5d5" title="This function changes the prescaler on the CLKM pin.">radio_set_clock_speed</a>(<span class="keywordtype">bool</span> direct, uint8_t clock_speed)</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;{</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="comment">/*Check function parameter and current clock speed.*/</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordflow">if</span> (clock_speed &gt; CLKM_16MHZ){</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73a9dc11f55b8f5a813e72002eb36710389" title="One or more of the supplied function arguments are invalid.">RADIO_INVALID_ARGUMENT</a>;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#gafd5fa5fa5a7629d3b940552afbe5c142" title="This function returns the current clock setting for the CLKM pin.">radio_get_clock_speed</a>() == clock_speed){</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="comment">/*Select to change the CLKM frequency directly or after returning from SLEEP.*/</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordflow">if</span> (direct == <span class="keyword">false</span>){</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a3517409068f4c36eedae73ed8ffead13" title="Access parameters for sub-register CLKM_SHA_SEL in register RG_TRX_CTRL_0.">SR_CLKM_SHA_SEL</a>, 1);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a3517409068f4c36eedae73ed8ffead13" title="Access parameters for sub-register CLKM_SHA_SEL in register RG_TRX_CTRL_0.">SR_CLKM_SHA_SEL</a>, 0);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    }</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#ac108f260911d536daba845f79a0c7eff" title="Access parameters for sub-register CLKM_CTRL in register RG_TRX_CTRL_0.">SR_CLKM_CTRL</a>, clock_speed);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;}</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment">/** \brief  This function calibrates the Single Side Band Filter.</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment"> *  \retval     RADIO_SUCCESS    Filter is calibrated.</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment"> *  \retval     RADIO_TIMED_OUT  The calibration could not be completed within time.</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment"> *  \retval     RADIO_WRONG_STATE This function can only be called from TRX_OFF or</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment"> *              PLL_ON.</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l00659"></a><span class="lineno"><a class="code" href="a01779.html#ga2158bddd81b0f0c610e2ef3ae371b2f4">  659</a></span>&#160;<a class="code" href="a01779.html#ga2158bddd81b0f0c610e2ef3ae371b2f4" title="This function calibrates the Single Side Band Filter.">radio_calibrate_filter</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;{</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="comment">/*Check current state. Only possible to do filter calibration from TRX_OFF or PLL_ON.*/</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    uint8_t trx_state = <a class="code" href="a01779.html#ga8e301ea5e85cf022a857a892f98b4a62" title="This function return the Radio Transceivers current state.">radio_get_trx_state</a>();</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordflow">if</span> ((trx_state != <a class="code" href="a00668.html#ad9aff3d987888b9d1bcb9fc12d2c996e" title="Constant TRX_OFF for sub-register SR_TRX_STATUS.">TRX_OFF</a>) &amp;&amp;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        (trx_state != <a class="code" href="a00668.html#a77a32ac338596fe95ea09d7603d7c295" title="Constant PLL_ON for sub-register SR_TRX_STATUS.">PLL_ON</a>)){</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae2cba4f4b63e5ff3c6e3a4bbbb1358e5" title="The end-user tried to do an invalid state transition.">RADIO_WRONG_STATE</a>;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    }</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="comment">/* Start the tuning algorithm by writing one to the FTN_START subregister. */</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a1a77552f46a81081a7c06ce03b855427" title="Access parameters for sub-register FTN_START in register RG_FTN_CTRL.">SR_FTN_START</a>, 1);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    delay_us(<a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dacbada1dc573b954bad0184f6b111c02b" title="Maximum time it should take to do the filter tuning.">TIME_FTN_TUNING</a>); <span class="comment">/* Wait for the calibration to finish. */</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a> filter_calibration_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ac1e26b7c1be4cb9607efaa1967061bd7" title="The requested service timed out.">RADIO_TIMED_OUT</a>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="comment">/* Verify the calibration result. */</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#a1a77552f46a81081a7c06ce03b855427" title="Access parameters for sub-register FTN_START in register RG_FTN_CTRL.">SR_FTN_START</a>) == FTN_CALIBRATION_DONE){</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        filter_calibration_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    }</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">return</span> filter_calibration_status;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;}</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">/** \brief  This function calibrates the PLL.</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment"> *  \retval     RADIO_SUCCESS    PLL Center Frequency and Delay Cell is calibrated.</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment"> *  \retval     RADIO_TIMED_OUT  The calibration could not be completed within time.</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment"> *  \retval     RADIO_WRONG_STATE This function can only be called from PLL_ON.</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l00691"></a><span class="lineno"><a class="code" href="a01779.html#ga82ec2ae781a717e100307ac9e546fe33">  691</a></span>&#160;<a class="code" href="a01779.html#ga82ec2ae781a717e100307ac9e546fe33" title="This function calibrates the PLL.">radio_calibrate_pll</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;{</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="comment">/*Check current state. Only possible to calibrate PLL from PLL_ON state*/</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga8e301ea5e85cf022a857a892f98b4a62" title="This function return the Radio Transceivers current state.">radio_get_trx_state</a>() != <a class="code" href="a00668.html#a77a32ac338596fe95ea09d7603d7c295" title="Constant PLL_ON for sub-register SR_TRX_STATUS.">PLL_ON</a>){</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae2cba4f4b63e5ff3c6e3a4bbbb1358e5" title="The end-user tried to do an invalid state transition.">RADIO_WRONG_STATE</a>;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    }</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="comment">/* Initiate the DCU and CF calibration loops. */</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a9403a03b192bcd225d457872e7738a2e" title="Access parameters for sub-register PLL_DCU_START in register RG_PLL_DCU.">SR_PLL_DCU_START</a>, 1);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#ad0563f355d208198921545ec804038eb" title="Access parameters for sub-register PLL_CF_START in register RG_PLL_CF.">SR_PLL_CF_START</a>, 1);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="comment">/* Wait maximum 150 us for the PLL to lock. */</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <a class="code" href="a01776.html#gacfa3d889af78723a3664088e4e297080" title="This function clears the PLL_LOCK flag.">hal_clear_pll_lock_flag</a>();</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    delay_us(<a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dae5b568fca41fce82055b00269565b7ef" title="Maximum time it should take for the PLL to lock.">TIME_PLL_LOCK</a>);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a> pll_calibration_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ac1e26b7c1be4cb9607efaa1967061bd7" title="The requested service timed out.">RADIO_TIMED_OUT</a>;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01776.html#ga1f167a5d5756dad8d888a9fb7f6e21a3" title="This function returns the current value of the PLL_LOCK flag.">hal_get_pll_lock_flag</a>() &gt; 0){</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#a9403a03b192bcd225d457872e7738a2e" title="Access parameters for sub-register PLL_DCU_START in register RG_PLL_DCU.">SR_PLL_DCU_START</a>) == PLL_DCU_CALIBRATION_DONE){</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#ad0563f355d208198921545ec804038eb" title="Access parameters for sub-register PLL_CF_START in register RG_PLL_CF.">SR_PLL_CF_START</a>) == PLL_CF_CALIBRATION_DONE){</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                pll_calibration_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            }</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">return</span> pll_calibration_status;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;}</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">/** \brief  This function return the Radio Transceivers current state.</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment"> *  \retval     P_ON               When the external supply voltage (VDD) is</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment"> *                                 first supplied to the transceiver IC, the</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment"> *                                 system is in the P_ON (Poweron) mode.</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment"> *  \retval     BUSY_RX            The radio transceiver is busy receiving a</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment"> *                                 frame.</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment"> *  \retval     BUSY_TX            The radio transceiver is busy transmitting a</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment"> *                                 frame.</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment"> *  \retval     RX_ON              The RX_ON mode enables the analog and digital</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="comment"> *                                 receiver blocks and the PLL frequency</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment"> *                                 synthesizer.</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment"> *  \retval     TRX_OFF            In this mode, the SPI module and crystal</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment"> *                                 oscillator are active.</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment"> *  \retval     PLL_ON             Entering the PLL_ON mode from TRX_OFF will</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment"> *                                 first enable the analog voltage regulator. The</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment"> *                                 transceiver is ready to transmit a frame.</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment"> *  \retval     BUSY_RX_AACK       The radio was in RX_AACK_ON mode and received</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment"> *                                 the Start of Frame Delimiter (SFD). State</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment"> *                                 transition to BUSY_RX_AACK is done if the SFD</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment"> *                                 is valid.</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment"> *  \retval     BUSY_TX_ARET       The radio transceiver is busy handling the</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment"> *                                 auto retry mechanism.</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment"> *  \retval     RX_AACK_ON         The auto acknowledge mode of the radio is</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment"> *                                 enabled and it is waiting for an incomming</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment"> *                                 frame.</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="comment"> *  \retval     TX_ARET_ON         The auto retry mechanism is enabled and the</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment"> *                                 radio transceiver is waiting for the user to</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment"> *                                 send the TX_START command.</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment"> *  \retval     RX_ON_NOCLK        The radio transceiver is listening for</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment"> *                                 incomming frames, but the CLKM is disabled so</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment"> *                                 that the controller could be sleeping.</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="comment"> *                                 However, this is only true if the controller</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment"> *                                 is run from the clock output of the radio.</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment"> *  \retval     RX_AACK_ON_NOCLK   Same as the RX_ON_NOCLK state, but with the</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment"> *                                 auto acknowledge module turned on.</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment"> *  \retval     BUSY_RX_AACK_NOCLK Same as BUSY_RX_AACK, but the controller</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment"> *                                 could be sleeping since the CLKM pin is</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment"> *                                 disabled.</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment"> *  \retval     STATE_TRANSITION   The radio transceiver&#39;s state machine is in</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment"> *                                 transition between two states.</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;uint8_t</div>
<div class="line"><a name="l00764"></a><span class="lineno"><a class="code" href="a01779.html#ga8e301ea5e85cf022a857a892f98b4a62">  764</a></span>&#160;<a class="code" href="a01779.html#ga8e301ea5e85cf022a857a892f98b4a62" title="This function return the Radio Transceivers current state.">radio_get_trx_state</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;{</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#abb9dcc6f85b1154d76645b5de64d4835" title="Access parameters for sub-register TRX_STATUS in register RG_TRX_STATUS.">SR_TRX_STATUS</a>);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;}</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment">/** \brief  This function checks if the radio transceiver is sleeping.</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment"> *  \retval     true    The radio transceiver is in SLEEP or one of the *_NOCLK</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment"> *                      states.</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment"> *  \retval     false   The radio transceiver is not sleeping.</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00776"></a><span class="lineno"><a class="code" href="a01779.html#ga7c4b1fbd30174589d1a0660f30a543e3">  776</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="a01779.html#ga7c4b1fbd30174589d1a0660f30a543e3" title="This function checks if the radio transceiver is sleeping.">radio_is_sleeping</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;{</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordtype">bool</span> sleeping = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="comment">/* The radio transceiver will be at SLEEP or one of the *_NOCLK states only if */</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="comment">/* the SLP_TR pin is high. */</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01776.html#gaf84d2cf7ef1ceb94be57bc20be328cea" title="Read current state of the SLP_TR pin (High/Low).">hal_get_slptr</a>() != 0){</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        sleeping = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordflow">return</span> sleeping;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;}</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">/** \brief  This function will change the current state of the radio</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment"> *          transceiver&#39;s internal state machine.</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment"> *  \param     new_state        Here is a list of possible states:</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment"> *             - RX_ON        Requested transition to RX_ON state.</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment"> *             - TRX_OFF      Requested transition to TRX_OFF state.</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment"> *             - PLL_ON       Requested transition to PLL_ON state.</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment"> *             - RX_AACK_ON   Requested transition to RX_AACK_ON state.</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"> *             - TX_ARET_ON   Requested transition to TX_ARET_ON state.</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment"> *  \retval    RADIO_SUCCESS          Requested state transition completed</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment"> *                                  successfully.</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment"> *  \retval    RADIO_INVALID_ARGUMENT Supplied function parameter out of bounds.</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="comment"> *  \retval    RADIO_WRONG_STATE      Illegal state to do transition from.</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="comment"> *  \retval    RADIO_BUSY_STATE       The radio transceiver is busy.</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="comment"> *  \retval    RADIO_TIMED_OUT        The state transition could not be completed</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="comment"> *                                  within resonable time.</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l00809"></a><span class="lineno"><a class="code" href="a01779.html#ga06b43a13b2efd1a4e0c1b9ae7a204c81">  809</a></span>&#160;<a class="code" href="a01779.html#ga06b43a13b2efd1a4e0c1b9ae7a204c81" title="This function will change the current state of the radio transceiver&#39;s internal state machine...">radio_set_trx_state</a>(uint8_t new_state)</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;{</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    uint8_t original_state;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="comment">/*Check function paramter and current state of the radio transceiver.*/</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">if</span> (!((new_state == <a class="code" href="a00668.html#ad9aff3d987888b9d1bcb9fc12d2c996e" title="Constant TRX_OFF for sub-register SR_TRX_STATUS.">TRX_OFF</a>)    ||</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;          (new_state == <a class="code" href="a00668.html#a359db88bcffa6b39bdb64ec00ec3a1ae" title="Constant RX_ON for sub-register SR_TRX_STATUS.">RX_ON</a>)      ||</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;          (new_state == <a class="code" href="a00668.html#a77a32ac338596fe95ea09d7603d7c295" title="Constant PLL_ON for sub-register SR_TRX_STATUS.">PLL_ON</a>)     ||</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;          (new_state == <a class="code" href="a00668.html#afddeaef97c7252f303f60355d79bf04c" title="Constant RX_AACK_ON for sub-register SR_TRX_STATUS.">RX_AACK_ON</a>) ||</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;          (new_state == <a class="code" href="a00668.html#a0d659f730692556a1b5e68f54c8ae015" title="Constant TX_ARET_ON for sub-register SR_TRX_STATUS.">TX_ARET_ON</a>))){</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73a9dc11f55b8f5a813e72002eb36710389" title="One or more of the supplied function arguments are invalid.">RADIO_INVALID_ARGUMENT</a>;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    }</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga7c4b1fbd30174589d1a0660f30a543e3" title="This function checks if the radio transceiver is sleeping.">radio_is_sleeping</a>() == <span class="keyword">true</span>){</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae2cba4f4b63e5ff3c6e3a4bbbb1358e5" title="The end-user tried to do an invalid state transition.">RADIO_WRONG_STATE</a>;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="comment">// Wait for radio to finish previous operation</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordflow">for</span>(;;)</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    {</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        original_state = <a class="code" href="a01779.html#ga8e301ea5e85cf022a857a892f98b4a62" title="This function return the Radio Transceivers current state.">radio_get_trx_state</a>();</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="keywordflow">if</span> (original_state != <a class="code" href="a00668.html#a4480cfa57a0f162471e351fce3ce72da" title="Constant BUSY_TX_ARET for sub-register SR_TRX_STATUS.">BUSY_TX_ARET</a> &amp;&amp;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            original_state != <a class="code" href="a00668.html#ab128af01291fb016509cce7df4de6233" title="Constant SLEEP for sub-register SR_TRX_STATUS.">BUSY_RX_AACK</a> &amp;&amp;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            original_state != <a class="code" href="a00668.html#a9486d08d26658473840dd55ef9d59783" title="Constant BUSY_RX for sub-register SR_TRX_STATUS.">BUSY_RX</a> &amp;&amp; </div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;            original_state != <a class="code" href="a00668.html#a9cbdb413702bfd45c35773bee53c4cd3" title="Constant BUSY_TX for sub-register SR_TRX_STATUS.">BUSY_TX</a>)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keywordflow">if</span> (new_state == original_state){</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    }</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="comment">/* At this point it is clear that the requested new_state is: */</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="comment">/* TRX_OFF, RX_ON, PLL_ON, RX_AACK_ON or TX_ARET_ON. */</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="comment">/* The radio transceiver can be in one of the following states: */</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="comment">/* TRX_OFF, RX_ON, PLL_ON, RX_AACK_ON, TX_ARET_ON. */</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keywordflow">if</span>(new_state == <a class="code" href="a00668.html#ad9aff3d987888b9d1bcb9fc12d2c996e" title="Constant TRX_OFF for sub-register SR_TRX_STATUS.">TRX_OFF</a>){</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <a class="code" href="a01779.html#gaa52f656bbbbd56a2935b9a54d55717d4" title="This function will reset the state machine (to TRX_OFF) from any of its states, except for the SLEEP ...">radio_reset_state_machine</a>(); <span class="comment">/* Go to TRX_OFF from any state. */</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="comment">/* It is not allowed to go from RX_AACK_ON or TX_AACK_ON and directly to */</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <span class="comment">/* TX_AACK_ON or RX_AACK_ON respectively. Need to go via RX_ON or PLL_ON. */</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <span class="keywordflow">if</span> ((new_state == <a class="code" href="a00668.html#a0d659f730692556a1b5e68f54c8ae015" title="Constant TX_ARET_ON for sub-register SR_TRX_STATUS.">TX_ARET_ON</a>) &amp;&amp;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            (original_state == <a class="code" href="a00668.html#afddeaef97c7252f303f60355d79bf04c" title="Constant RX_AACK_ON for sub-register SR_TRX_STATUS.">RX_AACK_ON</a>)){</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;            <span class="comment">/* First do intermediate state transition to PLL_ON, then to TX_ARET_ON. */</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            <span class="comment">/* The final state transition to TX_ARET_ON is handled after the if-else if. */</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a8d912618842812f37fc46356eff73c93" title="Access parameters for sub-register TRX_CMD in register RG_TRX_STATE.">SR_TRX_CMD</a>, <a class="code" href="a00668.html#a77a32ac338596fe95ea09d7603d7c295" title="Constant PLL_ON for sub-register SR_TRX_STATUS.">PLL_ON</a>);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            delay_us(<a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08daa68a9b1ecf13ab8095e32d86d35d416b" title="Transition time from PLL active state to another.">TIME_STATE_TRANSITION_PLL_ACTIVE</a>);</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((new_state == <a class="code" href="a00668.html#afddeaef97c7252f303f60355d79bf04c" title="Constant RX_AACK_ON for sub-register SR_TRX_STATUS.">RX_AACK_ON</a>) &amp;&amp;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                 (original_state == <a class="code" href="a00668.html#a0d659f730692556a1b5e68f54c8ae015" title="Constant TX_ARET_ON for sub-register SR_TRX_STATUS.">TX_ARET_ON</a>)){</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            <span class="comment">/* First do intermediate state transition to RX_ON, then to RX_AACK_ON. */</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            <span class="comment">/* The final state transition to RX_AACK_ON is handled after the if-else if. */</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a8d912618842812f37fc46356eff73c93" title="Access parameters for sub-register TRX_CMD in register RG_TRX_STATE.">SR_TRX_CMD</a>, <a class="code" href="a00668.html#a359db88bcffa6b39bdb64ec00ec3a1ae" title="Constant RX_ON for sub-register SR_TRX_STATUS.">RX_ON</a>);</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            delay_us(<a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08daa68a9b1ecf13ab8095e32d86d35d416b" title="Transition time from PLL active state to another.">TIME_STATE_TRANSITION_PLL_ACTIVE</a>);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        }</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        <span class="comment">/* Any other state transition can be done directly. */</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a8d912618842812f37fc46356eff73c93" title="Access parameters for sub-register TRX_CMD in register RG_TRX_STATE.">SR_TRX_CMD</a>, new_state);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <span class="comment">/* When the PLL is active most states can be reached in 1us. However, from */</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="comment">/* TRX_OFF the PLL needs time to activate. */</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="keywordflow">if</span> (original_state == <a class="code" href="a00668.html#ad9aff3d987888b9d1bcb9fc12d2c996e" title="Constant TRX_OFF for sub-register SR_TRX_STATUS.">TRX_OFF</a>){</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            delay_us(<a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08dab69e9ed03883d6e427ea2027fb3daf13" title="Transition time from TRX_OFF to: RX_ON, PLL_ON, TX_ARET_ON and RX_AACK_ON.">TIME_TRX_OFF_TO_PLL_ACTIVE</a>);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            delay_us(<a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08daa68a9b1ecf13ab8095e32d86d35d416b" title="Transition time from PLL active state to another.">TIME_STATE_TRANSITION_PLL_ACTIVE</a>);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        }</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    } <span class="comment">/*  end: if(new_state == TRX_OFF) ... */</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="comment">/*Verify state transition.*/</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a> set_state_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ac1e26b7c1be4cb9607efaa1967061bd7" title="The requested service timed out.">RADIO_TIMED_OUT</a>;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga8e301ea5e85cf022a857a892f98b4a62" title="This function return the Radio Transceivers current state.">radio_get_trx_state</a>() == new_state){</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        set_state_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        <span class="comment">/*  set rx_mode flag based on mode we&#39;re changing to */</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        <span class="keywordflow">if</span> (new_state == <a class="code" href="a00668.html#a359db88bcffa6b39bdb64ec00ec3a1ae" title="Constant RX_ON for sub-register SR_TRX_STATUS.">RX_ON</a> ||</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            new_state == <a class="code" href="a00668.html#afddeaef97c7252f303f60355d79bf04c" title="Constant RX_AACK_ON for sub-register SR_TRX_STATUS.">RX_AACK_ON</a>){</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            rx_mode = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            rx_mode = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    }</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">return</span> set_state_status;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;}</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">/** \brief  This function will put the radio transceiver to sleep.</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment"> *  \retval    RADIO_SUCCESS          Sleep mode entered successfully.</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment"> *  \retval    RADIO_TIMED_OUT        The transition to TRX_OFF took too long.</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l00902"></a><span class="lineno"><a class="code" href="a01779.html#ga94b281d32e42539a85cda615f92d1fed">  902</a></span>&#160;<a class="code" href="a01779.html#ga94b281d32e42539a85cda615f92d1fed" title="This function will put the radio transceiver to sleep.">radio_enter_sleep_mode</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;{</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga7c4b1fbd30174589d1a0660f30a543e3" title="This function checks if the radio transceiver is sleeping.">radio_is_sleeping</a>() == <span class="keyword">true</span>){</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    }</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <a class="code" href="a01779.html#gaa52f656bbbbd56a2935b9a54d55717d4" title="This function will reset the state machine (to TRX_OFF) from any of its states, except for the SLEEP ...">radio_reset_state_machine</a>(); <span class="comment">/* Force the device into TRX_OFF. */</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a> enter_sleep_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ac1e26b7c1be4cb9607efaa1967061bd7" title="The requested service timed out.">RADIO_TIMED_OUT</a>;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga8e301ea5e85cf022a857a892f98b4a62" title="This function return the Radio Transceivers current state.">radio_get_trx_state</a>() == <a class="code" href="a00668.html#ad9aff3d987888b9d1bcb9fc12d2c996e" title="Constant TRX_OFF for sub-register SR_TRX_STATUS.">TRX_OFF</a>){</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <span class="comment">/* Enter Sleep. */</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <a class="code" href="a01776.html#ga3187ed11240408b228dcaedd46f8793d" title="This macro pulls the SLP_TR pin high.">hal_set_slptr_high</a>();</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        enter_sleep_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="preprocessor">#if RADIOSTATS</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="preprocessor"></span>        RF230_radio_on = 0;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="preprocessor"></span>    }</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="keywordflow">return</span> enter_sleep_status;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;}</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">/** \brief  This function will take the radio transceiver from sleep mode and</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment"> *          put it into the TRX_OFF state.</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment"> *  \retval    RADIO_SUCCESS          Left sleep mode and entered TRX_OFF state.</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment"> *  \retval    RADIO_TIMED_OUT        Transition to TRX_OFF state timed out.</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l00932"></a><span class="lineno"><a class="code" href="a01779.html#ga66185e391cb6c0650805502a8c2dab68">  932</a></span>&#160;<a class="code" href="a01779.html#ga66185e391cb6c0650805502a8c2dab68" title="This function will take the radio transceiver from sleep mode and put it into the TRX_OFF state...">radio_leave_sleep_mode</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;{</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="comment">/* Check if the radio transceiver is actually sleeping. */</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga7c4b1fbd30174589d1a0660f30a543e3" title="This function checks if the radio transceiver is sleeping.">radio_is_sleeping</a>() == <span class="keyword">false</span>){</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    }</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <a class="code" href="a01776.html#ga8ceacb61f5cbdcac765a6b9bbab8c3ca" title="This macro pulls the SLP_TR pin low.">hal_set_slptr_low</a>();</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    delay_us(<a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08da7067e6c59db93ac323c375140eff1c51" title="Transition time from SLEEP to TRX_OFF.">TIME_SLEEP_TO_TRX_OFF</a>);</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a> leave_sleep_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ac1e26b7c1be4cb9607efaa1967061bd7" title="The requested service timed out.">RADIO_TIMED_OUT</a>;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="comment">/* Ensure that the radio transceiver is in the TRX_OFF state. */</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga8e301ea5e85cf022a857a892f98b4a62" title="This function return the Radio Transceivers current state.">radio_get_trx_state</a>() == <a class="code" href="a00668.html#ad9aff3d987888b9d1bcb9fc12d2c996e" title="Constant TRX_OFF for sub-register SR_TRX_STATUS.">TRX_OFF</a>){</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        leave_sleep_status = <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="preprocessor">#if RADIOSTATS</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="preprocessor"></span>        RF230_radio_on = 1;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="preprocessor"></span>    }</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordflow">return</span> leave_sleep_status;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;}</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">/** \brief  This function will reset the state machine (to TRX_OFF) from any of</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment"> *          its states, except for the SLEEP state.</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00960"></a><span class="lineno"><a class="code" href="a01779.html#gaa52f656bbbbd56a2935b9a54d55717d4">  960</a></span>&#160;<a class="code" href="a01779.html#gaa52f656bbbbd56a2935b9a54d55717d4" title="This function will reset the state machine (to TRX_OFF) from any of its states, except for the SLEEP ...">radio_reset_state_machine</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;{</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <a class="code" href="a01776.html#ga8ceacb61f5cbdcac765a6b9bbab8c3ca" title="This macro pulls the SLP_TR pin low.">hal_set_slptr_low</a>();</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    delay_us(<a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08da60b95807cc5d2690b9ee459c861c6a6c" title="Transition time from *_NOCLK to being awake.">TIME_NOCLK_TO_WAKE</a>);</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a8d912618842812f37fc46356eff73c93" title="Access parameters for sub-register TRX_CMD in register RG_TRX_STATE.">SR_TRX_CMD</a>, <a class="code" href="a00668.html#a8ecc63755abb125691b00426cba7fe41" title="Constant CMD_FORCE_TRX_OFF for sub-register SR_TRX_CMD.">CMD_FORCE_TRX_OFF</a>);</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    delay_us(<a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08daf50b81813c269484256d8d02b3751b4f" title="Time it takes to execute the FORCE_TRX_OFF command.">TIME_CMD_FORCE_TRX_OFF</a>);</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;}</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">/** \brief  This function will reset all the registers and the state machine of</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment"> *          the radio transceiver.</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00973"></a><span class="lineno"><a class="code" href="a01779.html#ga54684d521cdfbb1f049443846c73f10f">  973</a></span>&#160;<a class="code" href="a01779.html#ga54684d521cdfbb1f049443846c73f10f" title="This function will reset all the registers and the state machine of the radio transceiver.">radio_reset_trx</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;{</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <a class="code" href="a01776.html#gaa5044a550f2864bffafc79059e0462a5" title="This macro pulls the RST pin low.">hal_set_rst_low</a>();</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <a class="code" href="a01776.html#ga8ceacb61f5cbdcac765a6b9bbab8c3ca" title="This macro pulls the SLP_TR pin low.">hal_set_slptr_low</a>();</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    delay_us(<a class="code" href="a01779.html#gga7107f1e1a5e3b33325b5f7a489edb08da7987806807cc7ffc8afcafe42665af0f" title="Time to hold the RST pin low during reset.">TIME_RESET</a>);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <a class="code" href="a01776.html#gafad48edf9109099d92e884cc5456ac9e" title="This macro pulls the RST pin high.">hal_set_rst_high</a>();</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;}</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment">/** \brief  This function will enable or disable automatic CRC during frame</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment"> *          transmission.</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment"> *  \param  auto_crc_on If this parameter equals true auto CRC will be used for</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment"> *                      all frames to be transmitted. The framelength must be</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment"> *                      increased by two bytes (16 bit CRC). If the parameter equals</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment"> *                      false, the automatic CRC will be disabled.</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00991"></a><span class="lineno"><a class="code" href="a01779.html#ga4f1b3489c8f812a5fed20e35b13cad1e">  991</a></span>&#160;<a class="code" href="a01779.html#ga4f1b3489c8f812a5fed20e35b13cad1e" title="This function will enable or disable automatic CRC during frame transmission.">radio_use_auto_tx_crc</a>(<span class="keywordtype">bool</span> auto_crc_on)</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;{</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordflow">if</span> (auto_crc_on == <span class="keyword">true</span>){</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a53420a51ab0ad2e5b108d5cbbdf6f3b6" title="Access parameters for sub-register TX_AUTO_CRC_ON in register RG_PHY_TX_PWR.">SR_TX_AUTO_CRC_ON</a>, 1);</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a53420a51ab0ad2e5b108d5cbbdf6f3b6" title="Access parameters for sub-register TX_AUTO_CRC_ON in register RG_PHY_TX_PWR.">SR_TX_AUTO_CRC_ON</a>, 0);</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;}</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment">/** \brief  This function will download a frame to the radio transceiver&#39;s</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment"> *          transmit buffer and send it.</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment"> *  \param  data_length Length of the frame to be transmitted. 1 to 128 bytes are the valid lengths.</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment"> *  \param  *data   Pointer to the data to transmit</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment"> *  \retval RADIO_SUCCESS Frame downloaded and sent successfully.</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment"> *  \retval RADIO_INVALID_ARGUMENT If the dataLength is 0 byte or more than 127</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment"> *                               bytes the frame will not be sent.</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment"> *  \retval RADIO_WRONG_STATE It is only possible to use this function in the</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment"> *                          PLL_ON and TX_ARET_ON state. If any other state is</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment"> *                          detected this error message will be returned.</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l01015"></a><span class="lineno"><a class="code" href="a01779.html#ga63f716877b73d38e8a26e2377c57800f"> 1015</a></span>&#160;<a class="code" href="a01779.html#ga63f716877b73d38e8a26e2377c57800f" title="This function will download a frame to the radio transceiver&#39;s transmit buffer and send it...">radio_send_data</a>(uint8_t data_length, uint8_t *data)</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;{</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="comment">/*Check function parameters and current state.*/</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="keywordflow">if</span> (data_length &gt; <a class="code" href="a01779.html#ga10dcfc3d2532723ff24667fcd408b012" title="127 Byte PSDU.">RF230_MAX_TX_FRAME_LENGTH</a>){</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="preprocessor">#if RADIOSTATS</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="preprocessor"></span>        RF230_sendfail++;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73a9dc11f55b8f5a813e72002eb36710389" title="One or more of the supplied function arguments are invalid.">RADIO_INVALID_ARGUMENT</a>;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    }</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;     <span class="comment">/* If we are busy, return */</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="a01779.html#ga8e301ea5e85cf022a857a892f98b4a62" title="This function return the Radio Transceivers current state.">radio_get_trx_state</a>() == <a class="code" href="a00668.html#a9cbdb413702bfd45c35773bee53c4cd3" title="Constant BUSY_TX for sub-register SR_TRX_STATUS.">BUSY_TX</a>) || (<a class="code" href="a01779.html#ga8e301ea5e85cf022a857a892f98b4a62" title="This function return the Radio Transceivers current state.">radio_get_trx_state</a>() == <a class="code" href="a00668.html#a4480cfa57a0f162471e351fce3ce72da" title="Constant BUSY_TX_ARET for sub-register SR_TRX_STATUS.">BUSY_TX_ARET</a>) )</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        {</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="preprocessor">#if RADIOSTATS</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="preprocessor"></span>        RF230_sendfail++;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae2cba4f4b63e5ff3c6e3a4bbbb1358e5" title="The end-user tried to do an invalid state transition.">RADIO_WRONG_STATE</a>;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        }</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <a class="code" href="a01779.html#ga06b43a13b2efd1a4e0c1b9ae7a204c81" title="This function will change the current state of the radio transceiver&#39;s internal state machine...">radio_set_trx_state</a>(<a class="code" href="a00668.html#ad9aff3d987888b9d1bcb9fc12d2c996e" title="Constant TRX_OFF for sub-register SR_TRX_STATUS.">TRX_OFF</a>);</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <a class="code" href="a01779.html#ga06b43a13b2efd1a4e0c1b9ae7a204c81" title="This function will change the current state of the radio transceiver&#39;s internal state machine...">radio_set_trx_state</a>(<a class="code" href="a00668.html#a0d659f730692556a1b5e68f54c8ae015" title="Constant TX_ARET_ON for sub-register SR_TRX_STATUS.">TX_ARET_ON</a>);</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="comment">/*Do frame transmission.*/</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <span class="comment">/* Toggle the SLP_TR pin to initiate the frame transmission. */</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <a class="code" href="a01776.html#ga3187ed11240408b228dcaedd46f8793d" title="This macro pulls the SLP_TR pin high.">hal_set_slptr_high</a>();</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <a class="code" href="a01776.html#ga8ceacb61f5cbdcac765a6b9bbab8c3ca" title="This macro pulls the SLP_TR pin low.">hal_set_slptr_low</a>();</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <a class="code" href="a01776.html#ga67987dac2602b2c58d53d93a7c801cd1" title="This function will download a frame to the radio transceiver&#39;s frame buffer.">hal_frame_write</a>(data, data_length); <span class="comment">/* Then write data to the frame buffer. */</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="preprocessor">#if RADIOSTATS</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="preprocessor"></span>    RF230_sendpackets++;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;}</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment">/** \brief  This function will read the I_AM_COORD sub register.</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment"> *  \retval 0 Not coordinator.</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment"> *  \retval 1 Coordinator role enabled.</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;uint8_t</div>
<div class="line"><a name="l01056"></a><span class="lineno"><a class="code" href="a01779.html#gae3be9b1c85688303eb401f88c407ecd5"> 1056</a></span>&#160;<a class="code" href="a01779.html#gae3be9b1c85688303eb401f88c407ecd5" title="This function will read the I_AM_COORD sub register.">radio_get_device_role</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;{</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a01776.html#ga3af07027e6111b4d8798bf3b33dce065" title="This function reads the value of a specific subregister.">hal_subregister_read</a>(<a class="code" href="a00668.html#a0111e087406382c6197244d030b39dac" title="Access parameters for sub-register I_AM_COORD in register RG_CSMA_SEED_1.">SR_I_AM_COORD</a>);</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;}</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment">/** \brief  This function will set the I_AM_COORD sub register.</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment"> *  \param[in] i_am_coordinator If this parameter is true, the associated</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment"> *                              coordinator role will be enabled in the radio</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment"> *                              transceiver&#39;s address filter.</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment"> *                              False disables the same feature.</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"><a class="code" href="a01779.html#ga341915908f7757056728a35e23431a24"> 1070</a></span>&#160;<a class="code" href="a01779.html#ga341915908f7757056728a35e23431a24" title="This function will set the I_AM_COORD sub register.">radio_set_device_role</a>(<span class="keywordtype">bool</span> i_am_coordinator)</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;{</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a0111e087406382c6197244d030b39dac" title="Access parameters for sub-register I_AM_COORD in register RG_CSMA_SEED_1.">SR_I_AM_COORD</a>, i_am_coordinator);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;}</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">/** \brief  This function will return the PANID used by the address filter.</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment"> *  \retval Any value from 0 to 0xFFFF.</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;uint16_t</div>
<div class="line"><a name="l01081"></a><span class="lineno"><a class="code" href="a01779.html#ga03f8d1a25d36623015a9bb875b38bae6"> 1081</a></span>&#160;<a class="code" href="a01779.html#ga03f8d1a25d36623015a9bb875b38bae6" title="This function will return the PANID used by the address filter.">radio_get_pan_id</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;{</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    uint8_t pan_id_15_8 = <a class="code" href="a01776.html#gaf3c702dd022b52907dc882a346a16819" title="This function reads data from one of the radio transceiver&#39;s registers.">hal_register_read</a>(<a class="code" href="a00668.html#a30cf03f218f9c36554315f737abbedd5" title="Offset for register PAN_ID_1.">RG_PAN_ID_1</a>); <span class="comment">/*  Read pan_id_15_8. */</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    uint8_t pan_id_7_0 = <a class="code" href="a01776.html#gaf3c702dd022b52907dc882a346a16819" title="This function reads data from one of the radio transceiver&#39;s registers.">hal_register_read</a>(<a class="code" href="a00668.html#a7e9a100296620bd87365a5355e3ff28d" title="Offset for register PAN_ID_0.">RG_PAN_ID_0</a>); <span class="comment">/*  Read pan_id_7_0. */</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    uint16_t pan_id = ((uint16_t)(pan_id_15_8 &lt;&lt; 8)) | pan_id_7_0;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordflow">return</span> pan_id;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;}</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">/** \brief  This function will set the PANID used by the address filter.</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment"> *  \param  new_pan_id Desired PANID. Can be any value from 0x0000 to 0xFFFF</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"><a class="code" href="a01779.html#gaa83b626a6ad6b73889df5748f263fa06"> 1098</a></span>&#160;<a class="code" href="a01779.html#gaa83b626a6ad6b73889df5748f263fa06" title="This function will set the PANID used by the address filter.">radio_set_pan_id</a>(uint16_t new_pan_id)</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;{</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    uint8_t pan_byte = new_pan_id &amp; 0xFF; <span class="comment">/*  Extract new_pan_id_7_0. */</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <a class="code" href="a01776.html#ga733238be74ad06adfc1720e56427a447" title="This function writes a new value to one of the radio transceiver&#39;s registers.">hal_register_write</a>(<a class="code" href="a00668.html#a7e9a100296620bd87365a5355e3ff28d" title="Offset for register PAN_ID_0.">RG_PAN_ID_0</a>, pan_byte);</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    pan_byte = (new_pan_id &gt;&gt; 8*1) &amp; 0xFF;  <span class="comment">/*  Extract new_pan_id_15_8. */</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <a class="code" href="a01776.html#ga733238be74ad06adfc1720e56427a447" title="This function writes a new value to one of the radio transceiver&#39;s registers.">hal_register_write</a>(<a class="code" href="a00668.html#a30cf03f218f9c36554315f737abbedd5" title="Offset for register PAN_ID_1.">RG_PAN_ID_1</a>, pan_byte);</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;}</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment">/** \brief  This function will return the current short address used by the</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment"> *          address filter.</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment"> *  \retval Any value from 0x0000 to 0xFFFF</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;uint16_t</div>
<div class="line"><a name="l01115"></a><span class="lineno"><a class="code" href="a01779.html#gad8bc0ed106db566a0cdfc3d487ef86a8"> 1115</a></span>&#160;<a class="code" href="a01779.html#gad8bc0ed106db566a0cdfc3d487ef86a8" title="This function will return the current short address used by the address filter.">radio_get_short_address</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;{</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    uint8_t short_address_15_8 = <a class="code" href="a01776.html#gaf3c702dd022b52907dc882a346a16819" title="This function reads data from one of the radio transceiver&#39;s registers.">hal_register_read</a>(<a class="code" href="a00668.html#aa60598fa1041cdf9caa245cc9fbd52cd" title="Offset for register SHORT_ADDR_1.">RG_SHORT_ADDR_1</a>); <span class="comment">/*  Read short_address_15_8. */</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    uint8_t short_address_7_0  = <a class="code" href="a01776.html#gaf3c702dd022b52907dc882a346a16819" title="This function reads data from one of the radio transceiver&#39;s registers.">hal_register_read</a>(<a class="code" href="a00668.html#aa60598fa1041cdf9caa245cc9fbd52cd" title="Offset for register SHORT_ADDR_1.">RG_SHORT_ADDR_1</a>); <span class="comment">/*  Read short_address_7_0. */</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    uint16_t short_address = ((uint16_t)(short_address_15_8 &lt;&lt; 8)) | short_address_7_0;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="keywordflow">return</span> short_address;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;}</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">/** \brief  This function will set the short address used by the address filter.</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment"> *  \param  new_short_address Short address to be used by the address filter.</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"><a class="code" href="a01779.html#ga3e03858ffe27d2da715ba98f466c4c8d"> 1132</a></span>&#160;<a class="code" href="a01779.html#ga3e03858ffe27d2da715ba98f466c4c8d" title="This function will set the short address used by the address filter.">radio_set_short_address</a>(uint16_t new_short_address)</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;{</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    uint8_t short_address_byte = new_short_address &amp; 0xFF; <span class="comment">/*  Extract short_address_7_0. */</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <a class="code" href="a01776.html#ga733238be74ad06adfc1720e56427a447" title="This function writes a new value to one of the radio transceiver&#39;s registers.">hal_register_write</a>(<a class="code" href="a00668.html#a7eb78713946ea45d4b96dea4fdfd635b" title="Offset for register SHORT_ADDR_0.">RG_SHORT_ADDR_0</a>, short_address_byte);</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    short_address_byte = (new_short_address &gt;&gt; 8*1) &amp; 0xFF; <span class="comment">/*  Extract short_address_15_8. */</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <a class="code" href="a01776.html#ga733238be74ad06adfc1720e56427a447" title="This function writes a new value to one of the radio transceiver&#39;s registers.">hal_register_write</a>(<a class="code" href="a00668.html#aa60598fa1041cdf9caa245cc9fbd52cd" title="Offset for register SHORT_ADDR_1.">RG_SHORT_ADDR_1</a>, short_address_byte);</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;}</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment">/** \brief  This function will read the extended address used by the address</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment"> *          filter.</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment"> *  \note In this function a pointer is used to convey the 64-bit result, since</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment"> *        it is very inefficient to use the stack for this.</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment"> *  \return Extended Address, any 64-bit value.</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"><a class="code" href="a01779.html#ga18683051789bac42b4f06db7fe5742b0"> 1152</a></span>&#160;<a class="code" href="a01779.html#ga18683051789bac42b4f06db7fe5742b0" title="This function will read the extended address used by the address filter.">radio_get_extended_address</a>(uint8_t *extended_address)</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;{</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    *extended_address++ = <a class="code" href="a01776.html#gaf3c702dd022b52907dc882a346a16819" title="This function reads data from one of the radio transceiver&#39;s registers.">hal_register_read</a>(<a class="code" href="a00668.html#a15e749d4ff747c1066a644142088c354" title="Offset for register IEEE_ADDR_0.">RG_IEEE_ADDR_0</a>);</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    *extended_address++ = <a class="code" href="a01776.html#gaf3c702dd022b52907dc882a346a16819" title="This function reads data from one of the radio transceiver&#39;s registers.">hal_register_read</a>(<a class="code" href="a00668.html#a1446d842abbb6236c0cc6e81aa55afd5" title="Offset for register IEEE_ADDR_1.">RG_IEEE_ADDR_1</a>);</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    *extended_address++ = <a class="code" href="a01776.html#gaf3c702dd022b52907dc882a346a16819" title="This function reads data from one of the radio transceiver&#39;s registers.">hal_register_read</a>(<a class="code" href="a00668.html#addc18e32ea6a4e7090d003a065325a07" title="Offset for register IEEE_ADDR_2.">RG_IEEE_ADDR_2</a>);</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    *extended_address++ = <a class="code" href="a01776.html#gaf3c702dd022b52907dc882a346a16819" title="This function reads data from one of the radio transceiver&#39;s registers.">hal_register_read</a>(<a class="code" href="a00668.html#a4363d1043e3ca7fd103c8671a7bb816c" title="Offset for register IEEE_ADDR_3.">RG_IEEE_ADDR_3</a>);</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    *extended_address++ = <a class="code" href="a01776.html#gaf3c702dd022b52907dc882a346a16819" title="This function reads data from one of the radio transceiver&#39;s registers.">hal_register_read</a>(<a class="code" href="a00668.html#a0af60fe759f1fb20a5fd1f1a6485ef55" title="Offset for register IEEE_ADDR_4.">RG_IEEE_ADDR_4</a>);</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    *extended_address++ = <a class="code" href="a01776.html#gaf3c702dd022b52907dc882a346a16819" title="This function reads data from one of the radio transceiver&#39;s registers.">hal_register_read</a>(<a class="code" href="a00668.html#a51e16dcb63978ac7f2da04f1d22f64d5" title="Offset for register IEEE_ADDR_5.">RG_IEEE_ADDR_5</a>);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    *extended_address++ = <a class="code" href="a01776.html#gaf3c702dd022b52907dc882a346a16819" title="This function reads data from one of the radio transceiver&#39;s registers.">hal_register_read</a>(<a class="code" href="a00668.html#a7a08fe5c18ce6b6aab8258e60437dbbd" title="Offset for register IEEE_ADDR_6.">RG_IEEE_ADDR_6</a>);</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    *extended_address   = <a class="code" href="a01776.html#gaf3c702dd022b52907dc882a346a16819" title="This function reads data from one of the radio transceiver&#39;s registers.">hal_register_read</a>(<a class="code" href="a00668.html#afc4833334492f3f1ca57d51f96a4a925" title="Offset for register IEEE_ADDR_7.">RG_IEEE_ADDR_7</a>);</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;}</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">/** \brief  This function will set a new extended address to be used by the</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment"> *          address filter.</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment"> *  \param  extended_address Extended address to be used by the address filter.</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"><a class="code" href="a01779.html#gabd8ff7b98defda140e74183f8b1092f2"> 1171</a></span>&#160;<a class="code" href="a01779.html#gabd8ff7b98defda140e74183f8b1092f2" title="This function will set a new extended address to be used by the address filter.">radio_set_extended_address</a>(uint8_t *extended_address)</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;{</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <a class="code" href="a01776.html#ga733238be74ad06adfc1720e56427a447" title="This function writes a new value to one of the radio transceiver&#39;s registers.">hal_register_write</a>(<a class="code" href="a00668.html#a15e749d4ff747c1066a644142088c354" title="Offset for register IEEE_ADDR_0.">RG_IEEE_ADDR_0</a>, *extended_address++);</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <a class="code" href="a01776.html#ga733238be74ad06adfc1720e56427a447" title="This function writes a new value to one of the radio transceiver&#39;s registers.">hal_register_write</a>(<a class="code" href="a00668.html#a1446d842abbb6236c0cc6e81aa55afd5" title="Offset for register IEEE_ADDR_1.">RG_IEEE_ADDR_1</a>, *extended_address++);</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <a class="code" href="a01776.html#ga733238be74ad06adfc1720e56427a447" title="This function writes a new value to one of the radio transceiver&#39;s registers.">hal_register_write</a>(<a class="code" href="a00668.html#addc18e32ea6a4e7090d003a065325a07" title="Offset for register IEEE_ADDR_2.">RG_IEEE_ADDR_2</a>, *extended_address++);</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <a class="code" href="a01776.html#ga733238be74ad06adfc1720e56427a447" title="This function writes a new value to one of the radio transceiver&#39;s registers.">hal_register_write</a>(<a class="code" href="a00668.html#a4363d1043e3ca7fd103c8671a7bb816c" title="Offset for register IEEE_ADDR_3.">RG_IEEE_ADDR_3</a>, *extended_address++);</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <a class="code" href="a01776.html#ga733238be74ad06adfc1720e56427a447" title="This function writes a new value to one of the radio transceiver&#39;s registers.">hal_register_write</a>(<a class="code" href="a00668.html#a0af60fe759f1fb20a5fd1f1a6485ef55" title="Offset for register IEEE_ADDR_4.">RG_IEEE_ADDR_4</a>, *extended_address++);</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <a class="code" href="a01776.html#ga733238be74ad06adfc1720e56427a447" title="This function writes a new value to one of the radio transceiver&#39;s registers.">hal_register_write</a>(<a class="code" href="a00668.html#a51e16dcb63978ac7f2da04f1d22f64d5" title="Offset for register IEEE_ADDR_5.">RG_IEEE_ADDR_5</a>, *extended_address++);</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <a class="code" href="a01776.html#ga733238be74ad06adfc1720e56427a447" title="This function writes a new value to one of the radio transceiver&#39;s registers.">hal_register_write</a>(<a class="code" href="a00668.html#a7a08fe5c18ce6b6aab8258e60437dbbd" title="Offset for register IEEE_ADDR_6.">RG_IEEE_ADDR_6</a>, *extended_address++);</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <a class="code" href="a01776.html#ga733238be74ad06adfc1720e56427a447" title="This function writes a new value to one of the radio transceiver&#39;s registers.">hal_register_write</a>(<a class="code" href="a00668.html#afc4833334492f3f1ca57d51f96a4a925" title="Offset for register IEEE_ADDR_7.">RG_IEEE_ADDR_7</a>, *extended_address++);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;}</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment">/** \brief  This function will configure the CSMA algorithm used by the radio</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment"> *          transceiver when transmitting data from TX_ARET_ON state.</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment"> *  \param  seed0 Lower 8 bits of the seed used for the random number generator</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment"> *                in the CSMA algorithm. Value range: 0 to 255.</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment"> *  \param  be_csma_seed1 Is a combined argument of the MIN_BE, MAX_CSMA_RETRIES</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment"> *                        and SEED1 variables:</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="comment"> *                        -# MIN_BE: Bit[7:6] Minimum back-off exponent in the</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment"> *                           CSMA/CA algorithm.</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment"> *                        -# MAX_CSMA_RETRIES: Bit[5:3] Number of retries in</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="comment"> *                          TX_ARET_ON mode to repeat the CSMA/CA procedures</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="comment"> *                          before the ARET procedure gives up.</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="comment"> *                        -# SEED1: Bits[2:0] Higher 3 bits of CSMA_SEED, bits[10:8]</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="comment"> *                           Seed for the random number generator in the</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="comment"> *                           CSMA/CA algorithm.</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment"> *  \retval RADIO_SUCCESS The CSMA algorithm was configured successfully.</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment"> *  \retval RADIO_WRONG_STATE This function should not be called in the</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="comment"> *                          SLEEP state.</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<a class="code" href="a01779.html#gab6afacea6a7310707d47839506c30a73" title="This enumeration defines the possible return values for the TAT API functions.">radio_status_t</a></div>
<div class="line"><a name="l01204"></a><span class="lineno"><a class="code" href="a01779.html#ga6fc45c43ddf10d2e44da12ed07bd4ba0"> 1204</a></span>&#160;<a class="code" href="a01779.html#ga6fc45c43ddf10d2e44da12ed07bd4ba0" title="This function will configure the CSMA algorithm used by the radio transceiver when transmitting data ...">radio_configure_csma</a>(uint8_t seed0, uint8_t be_csma_seed1)</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;{</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="comment">/*Check state.*/</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="a01779.html#ga7c4b1fbd30174589d1a0660f30a543e3" title="This function checks if the radio transceiver is sleeping.">radio_is_sleeping</a>() == <span class="keyword">true</span>){</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae2cba4f4b63e5ff3c6e3a4bbbb1358e5" title="The end-user tried to do an invalid state transition.">RADIO_WRONG_STATE</a>;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    }</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="comment">/*Extract parameters, and configure the CSMA-CA algorithm.*/</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    uint8_t back_off_exponent = (be_csma_seed1 &amp; 0xC0) &gt;&gt; 6;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    uint8_t csma_retries      = (be_csma_seed1 &amp; 0x38) &gt;&gt; 3;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    uint8_t seed1             = (be_csma_seed1 &amp; 0x07);</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a1c29b8561f46d5949033e45c4a0ddcd1" title="Access parameters for sub-register MAX_FRAME_RETRIES in register RG_XAH_CTRL_0.">SR_MAX_FRAME_RETRIES</a>, 0); <span class="comment">/* AT86RF230 rev A errata. */</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a90d23d615a36396e2d4ce50fc1126a60" title="Access parameters for sub-register MAX_CSMA_RETRIES in register RG_XAH_CTRL_0.">SR_MAX_CSMA_RETRIES</a>, csma_retries);</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a5c34ba9a75fedbe5c8366f6631f183ae" title="Access parameters for sub-register MIN_BE in register RG_CSMA_SEED_1.">SR_MIN_BE</a>, back_off_exponent);</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <a class="code" href="a01776.html#ga733238be74ad06adfc1720e56427a447" title="This function writes a new value to one of the radio transceiver&#39;s registers.">hal_register_write</a>(<a class="code" href="a00668.html#a0be03a19a6b1cf46a550cd0a5dc1b55b" title="Offset for register CSMA_SEED_0.">RG_CSMA_SEED_0</a>, seed0);</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <a class="code" href="a01776.html#ga3577f9187e7d5af04be3fd1377307ffa" title="This function writes a new value to one of the radio transceiver&#39;s subregisters.">hal_subregister_write</a>(<a class="code" href="a00668.html#a241aa49cdb91c3abad40cc050e10b144" title="Access parameters for sub-register CSMA_SEED_1 in register RG_CSMA_SEED_1.">SR_CSMA_SEED_1</a>, seed1);</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a01779.html#ggab6afacea6a7310707d47839506c30a73ae0cc54bacebeb0eccbddcca9ba2315fc" title="The requested service was performed successfully.">RADIO_SUCCESS</a>;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;}</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="comment">    \brief Calibrate the internal RC oscillator</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="comment">    This function calibrates the internal RC oscillator, based</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="comment">    on the 1 MHz clock supplied by the AT86RF2xx. In order to</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="comment">    verify the calibration result you can program the CKOUT fuse</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="comment">    and monitor the CPU clock on an I/O pin.</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">    \return TRUE if calibrate passed; FALSE if calibrate failed.</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"><a class="code" href="a01779.html#gae5a7da999baa03269a350ae58c55e2ec"> 1238</a></span>&#160;<a class="code" href="a01779.html#gae5a7da999baa03269a350ae58c55e2ec" title="Calibrate the internal RC oscillator.">calibrate_rc_osc_clkm</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;{</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <span class="keywordtype">bool</span> success = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    <span class="comment">/*  Use the 1 MHz CLK_M from the AT86RF230. */</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    uint16_t temp, counter;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    uint8_t osccal_saved;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    uint8_t tccr2b, tccr1b, tccr1a;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="comment">/*  in the following line, 1000000ULL represents the 1MHz input signal */</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <span class="comment">/*  from the radio.  265 is the number of counts to overflow 8-bit */</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="comment">/*  timer 2.  32 is the divide by 32 prescaler for timer 1.  F_CPU is */</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <span class="comment">/*  the main clock frequency. */</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="preprocessor">#define TARGETVAL ((1000000ULL * 256 * 32) / F_CPU)</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        osccal_saved = OSCCAL;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;        cli();</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        <a class="code" href="a01779.html#gaed81adcaca247848a64a7b612b1df5d5" title="This function changes the prescaler on the CLKM pin.">radio_set_clock_speed</a>(<span class="keyword">true</span>, <a class="code" href="a00668.html#a156a5c1dbce856cd6be41ff6f75fd716" title="Constant CLKM_1MHz for sub-register SR_CLKM_CTRL.">CLKM_1MHz</a>);</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="comment">/*  Save current values of timer status. */</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;        tccr2b = TCCR2B;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;        tccr1b = TCCR1B;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        tccr1a = TCCR1A;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="comment">/*  Stop timers 1 and 2. */</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="comment">/*  Set timer 1 to normal mode (no CTC, no PWM, just count). */</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        TCCR2B = 0;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        TCCR1B = 0;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        TCCR1A = 0;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <span class="keywordflow">for</span> (counter = 0; counter &lt; 1000;  counter++){</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;        <span class="comment">/*  Delete pending timer 1 and 2 interrupts, and clear the */</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;        <span class="comment">/*  counters. */</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;            TIFR1 = 0xFF;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;            TIFR2 = 0xFF;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;            TCNT2 = 0;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;            TCNT1 = 0;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        <span class="comment">/*  Timer 2 driven from clock divided by 32 */</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;            TCCR2B = (1 &lt;&lt; CS21) | (1 &lt;&lt; CS20);</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        <span class="comment">/*  Timer 1 driven with external clock */</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;            TCCR1B = (1 &lt;&lt; CS12) | (1 &lt;&lt; CS11);</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        <span class="comment">/*  Wait for timer 2 to overflow. */</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <span class="keywordflow">while</span> (!(TIFR2 &amp; (1 &lt;&lt; TOV2))){</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                ;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        }</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        <span class="comment">/*  Stop timer 1.  Now, TCNT1 contains the number of CPU cycles */</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        <span class="comment">/*  counted while timer 2 was counting */</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;            TCCR1B = 0;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;            TCCR2B = 0;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;            temp = TCNT1;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        <span class="keywordflow">if</span> (temp &lt; (uint16_t)(0.995 * TARGETVAL)){</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;            <span class="comment">/*  Too fast, slow down */</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                OSCCAL--;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp &gt; (uint16_t)(1.005 * TARGETVAL)){</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;            <span class="comment">/*  Too slow, speed up */</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;                OSCCAL++;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;            <span class="comment">/*  We are within +/- 0.5 % of our target frequency, so we&#39;re */</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            <span class="comment">/*  done. */</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;                success = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;            }</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;        }</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        <a class="code" href="a01779.html#gaed81adcaca247848a64a7b612b1df5d5" title="This function changes the prescaler on the CLKM pin.">radio_set_clock_speed</a>(<span class="keyword">true</span>, CLKM_DISABLED);</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="comment">/*  restore timer status regs */</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        TCCR2B = tccr2b;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        TCCR1B = tccr1b;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;        TCCR1A = tccr1a;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="keywordflow">if</span> (!success){</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="comment">/*  We failed, therefore restore previous OSCCAL value. */</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;            OSCCAL = osccal_saved;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        }</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <span class="keywordflow">return</span> success;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;}</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment">    \brief Calibrate the internal RC oscillator</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="comment">    This function calibrates the internal RC oscillator, based</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment">    on an external 32KHz crystal connected to TIMER2. In order to</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment">    verify the calibration result you can program the CKOUT fuse</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="comment">    and monitor the CPU clock on an I/O pin.</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"><a class="code" href="a01779.html#gaaa84b1c0e7ec53220e17cabca6832b52"> 1332</a></span>&#160;<a class="code" href="a01779.html#gaaa84b1c0e7ec53220e17cabca6832b52" title="Calibrate the internal RC oscillator.">calibrate_rc_osc_32k</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;{</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <span class="comment">/* Calibrate RC Oscillator: The calibration routine is done by clocking TIMER2</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment">     * from the external 32kHz crystal while running an internal timer simultaneously.</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment">     * The internal timer will be clocked at the same speed as the internal RC</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment">     * oscillator, while TIMER2 is running at 32768 Hz. This way it is not necessary</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment">     * to use a timed loop, and keep track cycles in timed loop vs. optimization</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment">     * and compiler.</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    uint8_t osccal_original = OSCCAL;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="keyword">volatile</span> uint16_t temp;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        </div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <span class="comment">/* This is bad practice, but seems to work. */</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    OSCCAL = 0x80;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  <span class="comment">//    PRR0 &amp;= ~((1 &lt;&lt; PRTIM2)|(1 &lt;&lt; PRTIM1)); /*  Enable Timer 1 and 2 */</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    TIMSK2 = 0x00; <span class="comment">/*  Disable Timer/Counter 2 interrupts. */</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    TIMSK1 = 0x00; <span class="comment">/*  Disable Timer/Counter 1 interrupts. */</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="comment">/* Enable TIMER/COUNTER 2 to be clocked from the external 32kHz clock crystal.</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="comment">     * Then wait for the timer to become stable before doing any calibration.</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    ASSR |= (1 &lt;&lt; AS2);</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <span class="keywordflow">while</span> (ASSR &amp; ((1 &lt;&lt; TCN2UB)|(1 &lt;&lt; OCR2AUB)|(1 &lt;&lt; TCR2AUB)|(1 &lt;&lt; TCR2BUB))) { ; }</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    TCCR2B = 1 &lt;&lt; CS20;   <span class="comment">/* run timer 2 at divide by 1 (32KHz) */</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <a class="code" href="a01776.html#ga0a4fb62f9e69209c9c8c8e34ebb3df6f" title="This macro will protect the following code from interrupts.">AVR_ENTER_CRITICAL_REGION</a>();</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    uint8_t counter = 128;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <span class="keywordtype">bool</span> cal_ok = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="keywordflow">do</span>{</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        <span class="comment">/* wait for timer to be ready for updated config */</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        TCCR1B = 1 &lt;&lt; CS10;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        <span class="keywordflow">while</span> (ASSR &amp; ((1 &lt;&lt; TCN2UB)|(1 &lt;&lt; OCR2AUB)|(1 &lt;&lt; TCR2AUB)|(1 &lt;&lt; TCR2BUB))) { ; }</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        TCNT2 = 0x80;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        TCNT1 = 0;</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        TIFR2 = 0xFF;</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        <span class="comment">/* Wait for TIMER/COUNTER 2 to overflow. Stop TIMER/COUNTER 1 and 2, and</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="comment">         * read the counter value of TIMER/COUNTER 1. It will now contain the</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment">         * number of cpu cycles elapsed within the period.</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        <span class="keywordflow">while</span> (!(TIFR2 &amp; (1 &lt;&lt; TOV2))){</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;            ;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;            }</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        temp = TCNT1;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        TCCR1B = 0;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="preprocessor">#define cal_upper (31250*1.05) // 32812 = 0x802c</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define cal_lower (31250*0.95) // 29687 = 0x73f7</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="preprocessor"></span>        <span class="comment">/* Iteratively reduce the error to be within limits */</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        <span class="keywordflow">if</span> (temp &lt; cal_lower) {</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;            <span class="comment">/* Too slow. Put the hammer down. */</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;            OSCCAL++;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp &gt; cal_upper) {</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;            <span class="comment">/* Too fast, retard. */</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;            OSCCAL--;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;            <span class="comment">/* The CPU clock frequency is now within +/- 0.5% of the target value. */</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;            cal_ok = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        }</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        counter--;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    } <span class="keywordflow">while</span> ((counter != 0) &amp;&amp; (<span class="keyword">false</span> == cal_ok));</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">true</span> != cal_ok) {</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        <span class="comment">/* We failed, therefore restore previous OSCCAL value. */</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        OSCCAL = osccal_original;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    }</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    TCCR2B = 0;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    ASSR &amp;= ~(1 &lt;&lt; AS2);</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="comment">/* Disable both timers again to save power. */</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="comment">//    PRR0 |= (1 &lt;&lt; PRTIM2);/* |(1 &lt;&lt; PRTIM1); */</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <a class="code" href="a01776.html#ga770b47b04eec57748be0826a3d23503b" title="This macro must always be used in conjunction with AVR_ENTER_CRITICAL_REGION so that interrupts are e...">AVR_LEAVE_CRITICAL_REGION</a>();</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;}</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment">/** @} */</span><span class="comment"></span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="comment">/** @} */</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="comment">/*EOF*/</span></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 24 2014 16:26:13 for Contiki-Inga 3.x by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
