<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Contiki-Inga 3.x: platform/avr-ravenlcd/raven3290.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Contiki-Inga 3.x
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_c5a52a81292cf9a5167198f4f346d6d9.html">platform</a></li><li class="navelem"><a class="el" href="dir_6a9afc8833722e15c2cfc8475406ba17.html">avr-ravenlcd</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">raven3290.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="a01311.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *     \mainpage ATmega3290p LCD Driver Software for Contiki Raven</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">*/</span><span class="comment"></span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *     \image html raven3290p.jpg</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *     \ingroup platform</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *     \defgroup lcdraven RZRAVEN LCD 3290p</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *     \section intro_lcd LCD Introduction</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *  This Raven LCD Driver application software was designed for a user interface</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *  to the Contiki 6LoWPAN collaboration on board the ATmega3290p. The</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *  LCD functionality uses the binary command set described in the release notes.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *  These binary commands can also be found in a list of main.h.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *     \section compile_lcd Compiling Raven LCD Driver</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *  The Raven LCD Driver is located in /platforms/avr-ravenlcd but it is not a contiki platform.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> *  $make TARGET=avr-ravenlcd will not work! Build it using the AVR Studio project and WinAVR or</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *  in Linux/Windows cmd/Cygwin $make in that directory. The AVR Studio dependency folder will confuse</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> *  additional makes, use $make CYG=1 to bypass /dep creation or do $rm -R dep as needed.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *   The .h file dependencies will be lost, so also $make CYG=1 clean after modifying any of those.</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> *     \section fuses_lcd Board fuse settings</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *  The Raven LCD (3290p device) requires the proper fuse settings to function properly.</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> *  They are automatically set when flashing the .elf file. When using a .hex file set them manually:</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> *   -# Raven LCD (3290p device)</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> *      -# Extended: &lt;b&gt;0xFF&lt;/b&gt; (No Brown Out)</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *      -# High: &lt;b&gt;0x99&lt;/b&gt; (JTAG and ISP enabled, No OCDEN or EEPROM saving required)</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> *      -# Low: &lt;b&gt;0xE2&lt;/b&gt; (Use Int RC OSC - Start-up Time:6CK + 65ms)</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> *     \section notes_lcd Operation Release Notes</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> *  After programming the Raven LCD 3290p with the proper image, you will be introduced to</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> *  the menu in the picture below:</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> *     \image html contiki_menu_3290.jpg</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> *  Operating the menu requires that the matching command set has been programmed into</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> *  the ATmega1284 application. This will allow the menu to communicate properly and control the</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> *  Contiki 6LoWPAN applcation on the 1284p.</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> *  During normal operation, you will need to make note of these &lt;b&gt;IMPORTANT&lt;/b&gt; operating instructions:</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> *   -# &lt;b&gt;Temp Sensor&lt;/b&gt; - The temperature sensor shares the same GPIO as the JTAG interface for the 3290p.</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> *   This requires the JTAG feature to be &lt;b&gt;disabled&lt;/b&gt; in order to have proper temperature readings.</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> *   -# &lt;b&gt;Debug Menu&lt;/b&gt; - The DEBUG menu setting is used to configure this JTAG feature.</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"> *      -# If the JTAG feature is enabled during a temperature reading attempt,</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"> *      the menu will signal a &lt;b&gt;caution&lt;/b&gt; symbol to the user letting them know the JTAG</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"> *      feature needs to be disabled.</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"> *     \image html caution.gif</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"> *      -# The JTAG header may also need to be physically disconnected from any external</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"> *      programming/debugging device in order to obtain correct temperature readings.</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"> *      -# The software will disable JTAG in sleep/doze modes. If the JTAG connection fails during</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"> *       reprogramming with AVR Studio, &quot;try again with external reset&quot; to recover.</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment"> *   -# &lt;b&gt;Temp Data&lt;/b&gt; - Once the temperature reading is proper, the user can send this reading</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"> *   to the webserver for Sensor Reading Data (&lt;b&gt;Once&lt;/b&gt; or &lt;b&gt;Auto&lt;/b&gt;). The webserver will</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"> *   only update the html data when &lt;b&gt;refreshed&lt;/b&gt;.</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"> *   -# &lt;b&gt;EXT_SUPL_SIG&lt;/b&gt; - This signal connects the external supply voltage to ADC2 through a divider.</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"> *   Enabling MEASURE_ADC2 in temp.h causes it to be sampled and sent to the 1284p along</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"> *   with the temperature.</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"> *   More information about the operation of the Raven with Contiki can be found in the contikiwiki at http://www.sics.se/~adam/wiki/index.php/Avr_Raven.</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"> *   \sa http://www.sics.se/contiki/tutorials/tutorial-running-contiki-with-uipv6-and-sicslowpan-support-on-the-atmel-raven.html</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment"> *     \section binary_lcd Binary Command Description</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment"> *  Using the binary commmand list described in main.h, the 3290p will contruct a binary</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment"> *  command serial frame to control the 1284p. An example command frame is contructed below:</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment"> *   -# &lt;b&gt;0x01,0x01,0x81,0x01,0x04&lt;/b&gt; - Send Ping Request number 1 to 1284p</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment"> *       -# &lt;b&gt;0x01&lt;/b&gt; - Start of binary command frame</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment"> *       -# &lt;b&gt;0x01&lt;/b&gt; - Length of binary command payload</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment"> *       -# &lt;b&gt;0x81&lt;/b&gt; - Binary command SEND_PING</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment"> *       -# &lt;b&gt;0x01&lt;/b&gt; - Payload value (eg. ping Request number 1)</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment"> *       -# &lt;b&gt;0x04&lt;/b&gt; - End of binary command frame</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"> *  The following commands are sent to the 1284p.</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"> *   -# &lt;b&gt;SEND_TEMP - (0x80)&lt;/b&gt;</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"> *   -# &lt;b&gt;SEND_PING - (0x81)&lt;/b&gt;</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"> *   -# &lt;b&gt;SEND_ADC2 - (0x82)&lt;/b&gt;</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"> *   -# &lt;b&gt;SEND_SLEEP- (0x83)&lt;/b&gt;</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"> *   -# &lt;b&gt;SEND_WAKE - (0x84)&lt;/b&gt;</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"> *  The following commands are received from the 1284p.</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"> *   -# &lt;b&gt;REPORT_PING      - (0xC0)&lt;/b&gt;</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"> *   -# &lt;b&gt;REPORT_PING_BEEP - (0xC1)&lt;/b&gt;</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"> *   -# &lt;b&gt;REPORT_TEXT_MSG  - (0xC2)&lt;/b&gt;</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment"> *   -# &lt;b&gt;REPORT_WAKE      - (0xC3)&lt;/b&gt;</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"> *     \section sleep_lcd Sleep and Doze</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"> *   -# The Raven draws 27 milliamps when the 3290p and 1284p are both running and the RF230 in receive mode.</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"> *   -# Sleeping the 3290p and LCD display drops this to 21 ma with no loss in contiki functionality.</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"> *   -# The RF230 radio draws 15.5/16.5/7.8/1.5/0.02 ma in Rx/Tx/PLL_ON/TRX_OFF/SLEEP states.</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"> *    It is controlled by contiki on the 1284p according to the selected MAC power protocols to obtain the</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment"> *    bulk of power savings; however the 3290p menu can tell it to sleep unconditionally or in a doze cycle.</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"> *   -# Unconditional SLEEP requires pushing the joystick button for wakeup. Once awake the 3290p sends</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"> *    SEND_WAKE commands to the 1284p until it responds with a REPORT_WAKE. &quot;WAIT 1284p&quot; is displayed during this time.</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment"> *    Current draw is 40 microamps.</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"> *   -# As configured, doze sleeps the 3290p for 5 seconds after telling 1284p to sleep for 4 seconds. The 3290p</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"> *    wakes briefly to send temperature and voltage to the 1284p (which should be awake at this time), then tells it to</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"> *    sleep again. Thus the 1284p will be active 20% of the time, although it may ignore the command to sleep</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment"> *    if there are active TCP connections.  The 3290p energy usage is essentially zero in this mode; total savings will</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"> *    depend on actual 1284p wake time and radio usage. Alter the timings as desired, or comment out the 1284p sleep</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"> *    command to shut down only the 3290p in doze mode.</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"> *  Copyright (c) 2008  Swedish Institute of Computer Science</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"> *  All rights reserved.</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"> *  Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"> *  modification, are permitted provided that the following conditions are met:</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"> *  * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"> *    notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"> *  * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"> *    notice, this list of conditions and the following disclaimer in</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment"> *    the documentation and/or other materials provided with the</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"> *    distribution.</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment"> *  * Neither the name of the copyright holders nor the names of</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment"> *    contributors may be used to endorse or promote products derived</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"> *    from this software without specific prior written permission.</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment"> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment"> */</span><span class="comment"></span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"> * \file</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"> * \brief</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"> *      This is the main file for the Raven LCD application.</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"> * \author</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment"> *      Mike Vidales mavida404@gmail.com</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a01474.html" title=" This file provides Raven LCD support.">lcd.h</a>&quot;</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a01307.html" title=" This file provides joystick operations.">key.h</a>&quot;</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a01308.html" title=" This is the main file for the Raven LCD application.">main.h</a>&quot;</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a01199.html" title=" Handles the control of the USART for communication with the ATmega1284p  for sending commands...">uart.h</a>&quot;</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a00492.html" title=" This file supports the timer functionality for the LCD.">timer.h</a>&quot;</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a01310.html" title=" This file operates the menu flow chart described in the readme  notes.">menu.h</a>&quot;</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a01314.html" title=" Interface for the onboard temperature sensor.">temp.h</a>&quot;</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="preprocessor">#include &lt;avr/io.h&gt;</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="preprocessor">#include &lt;avr/fuse.h&gt;</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;FUSES =</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                .low = 0xe2,</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                .high = 0x99,</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                .extended = 0xff,</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        };</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">/** \ingroup lcdraven</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">    \defgroup lcd LCD Functions and data</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment"> *  \{</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="preprocessor">#if defined( DOXYGEN )</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">char</span> menu_text0[];</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text1[];</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text2[];</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text3[];</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text4[];</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text5[];</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text6[];</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text7[];</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text8[];</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text9[];</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text10[];</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text11[];</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text12[];</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text13[];</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text14[];</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text15[];</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text16[];</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text17[];</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="keyword">const</span> <a class="code" href="a00102.html" title="This structure defines the joystick operation within the menu_items[].">tmenu_item</a> menu_items[18];</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="preprocessor">#else  </span><span class="comment">/* !DOXYGEN */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="preprocessor"></span><span class="comment">/** \brief This is the menu text in Flash. See menu_items[] for menu operation. */</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text0[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> =  <span class="stringliteral">&quot;CONTIKI&quot;</span>;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text1[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> =  <span class="stringliteral">&quot;6LOWPAN&quot;</span>;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text2[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> =  <span class="stringliteral">&quot;PING&quot;</span>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text3[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> =  <span class="stringliteral">&quot;PINGING&quot;</span>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text4[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> =  <span class="stringliteral">&quot;TEMP&quot;</span>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text5[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> =  <span class="stringliteral">&quot;MODE &quot;</span>;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text6[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> =  <span class="stringliteral">&quot;DEG F&quot;</span>;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text7[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> =  <span class="stringliteral">&quot;DEG C&quot;</span>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text8[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> =  <span class="stringliteral">&quot;SEND&quot;</span>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text9[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> =  <span class="stringliteral">&quot;ONCE&quot;</span>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text10[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> = <span class="stringliteral">&quot;AUTO&quot;</span>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text11[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> = <span class="stringliteral">&quot;DEBUG&quot;</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text12[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> = <span class="stringliteral">&quot;DBG ON&quot;</span>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text13[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> = <span class="stringliteral">&quot;DBG OFF&quot;</span>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text14[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> = <span class="stringliteral">&quot;SENT&quot;</span>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text15[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> = <span class="stringliteral">&quot;SENDING&quot;</span>;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text16[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> = <span class="stringliteral">&quot;SLEEP&quot;</span>;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> menu_text17[] <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> = <span class="stringliteral">&quot;DOZE&quot;</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">/*---------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment"> *   \brief Menus for user interface</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment"> *   This constructs the Raven 3290p menu for the Contiki and 6lowpan collaboration. This</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment"> *   follows the struct description of tmenu_item.</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment"> *   { text, left, right, up, down, *state, tmenufunc enter_func}</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keyword">const</span> <a class="code" href="a01797.html#gab745fa6af9f36165d3c78056a187d9aa" title="List of supported RNDIS OID&#39;s.">PROGMEM</a> <a class="code" href="a00102.html" title="This structure defines the joystick operation within the menu_items[].">tmenu_item</a> menu_items[18]  = {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    {menu_text0,   0,  2,  0,  0, 0,                       0                  },</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    {menu_text1,   0,  2,  0,  0, 0,                       0                  },</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    {menu_text2,   0,  3, 17,  4, 0,                       <a class="code" href="a01842.html#ga421d15bce31c4d7456b520c2b1a5036c" title="This will setup a ping request command to the 1284p and reset the ping counter.">menu_ping_request</a>  },</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    {menu_text3,   2,  2,  2,  2, 0,                       0                  },</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    {menu_text4,   0,  5,  2, 11, 0,                       0                  },</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    {menu_text5,   4,  6,  8,  8, 0,                       0                  },</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    {menu_text6,   5,  5,  7,  7, (uint8_t*)1,             <a class="code" href="a01842.html#gac40e0919e2dfa402b7e45905639c67e5" title="This will display the temperature in degrees F or C.">menu_read_temp</a>     },</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    {menu_text7,   5,  5,  6,  6, (uint8_t*)0,             <a class="code" href="a01842.html#gac40e0919e2dfa402b7e45905639c67e5" title="This will display the temperature in degrees F or C.">menu_read_temp</a>     },</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    {menu_text8,   4,  9,  5,  5, 0,                       0                  },</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    {menu_text9,   8, 14, 10, 10, (uint8_t*)0,             <a class="code" href="a01842.html#gafa97d56c14846e7e4ba61ab87ac66c1e" title="This will setup the current temperature for transfer to the ATmega1284p via a binary command transfer...">menu_prepare_temp</a>  },</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    {menu_text10,  8, 15,  9,  9, (uint8_t*)1,             <a class="code" href="a01842.html#gafa97d56c14846e7e4ba61ab87ac66c1e" title="This will setup the current temperature for transfer to the ATmega1284p via a binary command transfer...">menu_prepare_temp</a>  },</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    {menu_text11,  0, 12,  4, 16, 0,                       0                  },</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    {menu_text12, 11, 11, 13, 13, (uint8_t*)1,             <a class="code" href="a01842.html#ga6e093720f7c809bc699da9fd0be05b5d" title="This will enable or disable the JTAG debug interface to allow for proper temperature sensor readings...">menu_debug_mode</a>    },</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    {menu_text13, 11, 11, 12, 12, (uint8_t*)0,             <a class="code" href="a01842.html#ga6e093720f7c809bc699da9fd0be05b5d" title="This will enable or disable the JTAG debug interface to allow for proper temperature sensor readings...">menu_debug_mode</a>    },</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    {menu_text14, 9,  14, 14, 14, 0,                       0                  },</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    {menu_text15, 10, 15, 15, 15, 0,                       0                  },</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; <span class="comment">//   {menu_text16,  0, 16, 11, 17, (uint8_t*)&amp;menu_text16,  menu_run_sleep     },</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; <span class="comment">//   {menu_text17,  0, 17, 16,  2, (uint8_t*)&amp;menu_text17,  menu_run_doze      },</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    {menu_text16,  0, 16, 11, 17, (uint8_t*)1,  <a class="code" href="a01842.html#gaa7a5e2d36881b84df9fb90b4726ffe2a" title="This will start a sleep operation.">menu_run_sleep</a>     },<span class="comment">//display &quot;sleep&quot; on wake</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    {menu_text17,  0, 17, 16,  2, (uint8_t*)1,  <a class="code" href="a01842.html#gaacfc17a9e0e0cee9c61b5d164d7a7118" title="This will start a sleep with wakes for temperature measurement and web requests.">menu_run_doze</a>      },<span class="comment">//display &quot;doze&quot; on wake</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;};</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !DOXYGEN */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;key_state_t button=KEY_STATE_NO_KEY;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<a class="code" href="a00102.html" title="This structure defines the joystick operation within the menu_items[].">tmenu_item</a> menu;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;uint8_t count;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;uint8_t timeout_count;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">/*---------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment"> *   \brief This will read the menu_items[] from the index requested.</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment"> *   \param ndx Position index of menu_items[] lookup.</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00258"></a><span class="lineno"><a class="code" href="a01842.html#gaed0c7e19d4b54e566d4c78b0aa7d48c5">  258</a></span>&#160;<a class="code" href="a01842.html#gaed0c7e19d4b54e566d4c78b0aa7d48c5" title="This will read the menu_items[] from the index requested.">read_menu</a>(uint8_t ndx)</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;{</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">/* Reads menu structure from Flash area */</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    uint8_t i;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    uint8_t *src = (uint8_t*)&amp;menu_items[ndx];</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    uint8_t *dest = (uint8_t*)&amp;menu;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">for</span> (i=0;i&lt;<span class="keyword">sizeof</span>(<a class="code" href="a00102.html" title="This structure defines the joystick operation within the menu_items[].">tmenu_item</a>);i++){</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        *dest++ = pgm_read_byte(src+i);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;}</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">/*---------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="keywordtype">char</span> top_menu_text[20];<span class="comment"></span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment"> *   \brief This will toggle the CONTIKI and 6LOWPAN LCD menus in the main</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment"> *   menu position, unless alternate text has been sent from the 1284p.</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment"> *   The other menus will display normally.</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00278"></a><span class="lineno"><a class="code" href="a01842.html#ga3e510e8880fef43d634f2a074d8d6824">  278</a></span>&#160;<a class="code" href="a01842.html#ga3e510e8880fef43d634f2a074d8d6824" title="This will toggle the CONTIKI and 6LOWPAN LCD menus in the main menu position, unless alternate text h...">check_main_menu</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;{</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;uint8_t showtop=0;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">if</span>(menu.<a class="code" href="a00102.html#a45351b06fc507c32c662d8b291888e4d" title="Menu text to display.">text</a> == menu_text0){</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <a class="code" href="a01842.html#gaed0c7e19d4b54e566d4c78b0aa7d48c5" title="This will read the menu_items[] from the index requested.">read_menu</a>(1);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        showtop=1;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(menu.<a class="code" href="a00102.html#a45351b06fc507c32c662d8b291888e4d" title="Menu text to display.">text</a> == menu_text1){</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <a class="code" href="a01842.html#gaed0c7e19d4b54e566d4c78b0aa7d48c5" title="This will read the menu_items[] from the index requested.">read_menu</a>(0);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        showtop=1;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">if</span> (showtop) {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">if</span> (top_menu_text[0]) {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <a class="code" href="a01842.html#ga59af7ca8e7c3a3ffc862482d99d895f1" title="This will put a string of characters out to the LCD.">lcd_puts</a>(top_menu_text);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <a class="code" href="a01842.html#gaa51c71cfcccf7560027214528bb7ceaf" title="This will put a string out to the LCD from Flash.">lcd_puts_P</a>(menu.<a class="code" href="a00102.html#a45351b06fc507c32c662d8b291888e4d" title="Menu text to display.">text</a>);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">/*---------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment"> *   \brief This will check for the temp menu screen to determine if we need to</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment"> *   clear the 4 digit LCD segments or stop an auto temp send. Also check for</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment"> *   stopping a ping request.</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00307"></a><span class="lineno"><a class="code" href="a01842.html#ga394917f6adf383da5234e082473aeb97">  307</a></span>&#160;<a class="code" href="a01842.html#ga394917f6adf383da5234e082473aeb97" title="This will check for the temp menu screen to determine if we need to clear the 4 digit LCD segments or...">check_menu</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;{</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">if</span>(menu.<a class="code" href="a00102.html#a45351b06fc507c32c662d8b291888e4d" title="Menu text to display.">text</a> == menu_text12){</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;       <a class="code" href="a01842.html#ga4fccb95c47d5cb23216485f5cf083afa" title="This will clear the temperature displayed in the 4 digit LCD segments.">menu_clear_temp</a>();</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">if</span>(menu.<a class="code" href="a00102.html#a45351b06fc507c32c662d8b291888e4d" title="Menu text to display.">text</a> == menu_text10){</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <a class="code" href="a01842.html#gac36c1c74053d53db0febe97911c6163b" title="This will stop the auto sending of temperature data.">menu_stop_temp</a>();</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    }</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span>(menu.<a class="code" href="a00102.html#a45351b06fc507c32c662d8b291888e4d" title="Menu text to display.">text</a> == menu_text2){</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <a class="code" href="a01842.html#ga8b89c19a2578b3d61e32013e429270d8" title="This will stop the ping request.">menu_stop_ping</a>();</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <a class="code" href="a01842.html#ga70a1a8b00942a36e04eec25e58485877" title="This will clear numbers displayed on the LCD.">lcd_num_clr</a>();</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;}</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">/*---------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment"> *   \brief This is main...</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l00329"></a><span class="lineno"><a class="code" href="a01842.html#ga840291bc02cba5474a4cb46a9b9566fe">  329</a></span>&#160;<a class="code" href="a01799.html#ga840291bc02cba5474a4cb46a9b9566fe" title="Main routine for the cc2538dk platform.">main</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;{</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <a class="code" href="a01842.html#ga8934921ab17f707ecda798416098365e" title="This function will initialize the proper settings for the LCD driver.">lcd_init</a>();</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="a01842.html#ga5ff887d54f44f93cdf47cc2784d92101" title="This will intialize the joystick and the ADC for button readings.">key_init</a>();</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <a class="code" href="a01822.html#ga0c0ca72359ddf28dcd15900dfba19343" title="Initialises the UART controller, configures I/O control and interrupts.">uart_init</a>();</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <a class="code" href="a01757.html#ga4ec7f9d780da432051aa74ec5892a94c" title="Initialize the EEPROM module.">eeprom_init</a>();</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <a class="code" href="a01842.html#ga41c34508ee83563790799f455d78126f" title="This will initialize the digital IO and adc channel for temperture readings.">temp_init</a>();</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <a class="code" href="a01842.html#ga7b8ab79df77b57475a5494f5f81c3bd9" title="TIMER1 init for timer used by LCD.">timer_init</a>();</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    sei();</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="a01842.html#ga75d844cbdf33d973af97abda8903edc9" title="This will enable any of the symbols on the Raven LCD.">lcd_symbol_set</a>(LCD_SYMBOL_RAVEN);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <a class="code" href="a01842.html#ga75d844cbdf33d973af97abda8903edc9" title="This will enable any of the symbols on the Raven LCD.">lcd_symbol_set</a>(LCD_SYMBOL_IP);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment">/* Start with main menu */</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <a class="code" href="a01842.html#gaed0c7e19d4b54e566d4c78b0aa7d48c5" title="This will read the menu_items[] from the index requested.">read_menu</a>(0);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">/* and draw it */</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <a class="code" href="a01842.html#gaa51c71cfcccf7560027214528bb7ceaf" title="This will put a string out to the LCD from Flash.">lcd_puts_P</a>(menu.<a class="code" href="a00102.html#a45351b06fc507c32c662d8b291888e4d" title="Menu text to display.">text</a>);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <a class="code" href="a01842.html#gaeb09db6f93d0e0f5aad6e9d2345793e0" title="Start the timer.">timer_start</a>();</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">for</span> (;;){</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="comment">/* Make sure interrupts are always on */</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        sei();</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="comment">/* The one second timer has fired. */</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="keywordflow">if</span>(timer_flag){</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            timer_flag = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            <span class="comment">/* Check if main menu needs toggled. */</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            <a class="code" href="a01842.html#ga3e510e8880fef43d634f2a074d8d6824" title="This will toggle the CONTIKI and 6LOWPAN LCD menus in the main menu position, unless alternate text h...">check_main_menu</a>();</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <span class="comment">/* Update LCD with temp data. */</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            <span class="keywordflow">if</span>(temp_flag){</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                <a class="code" href="a01842.html#ga99aa282fecaffbbedd2881e74a0e7e90" title="This will display the temperature in degrees F or C.">menu_display_temp</a>();</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <span class="comment">/* Auto send temp data to 1284p. */</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            <span class="keywordflow">if</span>(auto_temp){</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                menu_send_temp();</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            }</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            <span class="comment">/* If ping mode, send 4 ping requests and then stop. */</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <span class="keywordflow">if</span>(ping_mode){</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                <span class="keywordflow">if</span>((PING_ATTEMPTS == count) &amp;&amp; !timeout_flag){</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                    count = 0;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                    timeout_count = 0;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                    <a class="code" href="a01842.html#ga8b89c19a2578b3d61e32013e429270d8" title="This will stop the ping request.">menu_stop_ping</a>();</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(timeout_flag){</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                    timeout_flag = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                    timeout_count++;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                    <span class="comment">/* Display timeout message if all PING_ATTEMPTS were not successful. */</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                    <span class="keywordflow">if</span>(PING_ATTEMPTS == timeout_count){</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                        <a class="code" href="a01842.html#gaa51c71cfcccf7560027214528bb7ceaf" title="This will put a string out to the LCD from Flash.">lcd_puts_P</a>(PSTR(<span class="stringliteral">&quot;PINGS FAILED&quot;</span>));</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                    }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                    count = <a class="code" href="a01842.html#ga5b7fa0d1e07525a452902c38c201244a" title="This will send the ping request to the 1284p via the serial port.">menu_send_ping</a>();</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="comment">/* Check for button press and deal with it */</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="a01842.html#gad5317e96a0b026894f45136d82034369" title="This will poll run key_task() to determine if a button has been pressed.">is_button</a>()){</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            <span class="comment">/* Dispatch the button pressed */</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <span class="keywordflow">switch</span> (<a class="code" href="a01842.html#ga165edc7450c709ada3c5e72acd30d986" title="This function will wait for a user to press a button.">get_button</a>()){</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                <span class="keywordflow">case</span> KEY_UP:</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                    <a class="code" href="a01842.html#gaed0c7e19d4b54e566d4c78b0aa7d48c5" title="This will read the menu_items[] from the index requested.">read_menu</a>(menu.<a class="code" href="a00102.html#a2a9ae6aa942d6f58a969df6ac6bf4cb0" title="Contains next menu position for up.">up</a>);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                    <a class="code" href="a01842.html#gaa51c71cfcccf7560027214528bb7ceaf" title="This will put a string out to the LCD from Flash.">lcd_puts_P</a>(menu.<a class="code" href="a00102.html#a45351b06fc507c32c662d8b291888e4d" title="Menu text to display.">text</a>);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                <span class="keywordflow">case</span> KEY_DOWN:</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                    <a class="code" href="a01842.html#gaed0c7e19d4b54e566d4c78b0aa7d48c5" title="This will read the menu_items[] from the index requested.">read_menu</a>(menu.<a class="code" href="a00102.html#a4ae96a671d08b132aaea6bcd843a4e41" title="Contains next menu position for down.">down</a>);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                    <a class="code" href="a01842.html#gaa51c71cfcccf7560027214528bb7ceaf" title="This will put a string out to the LCD from Flash.">lcd_puts_P</a>(menu.<a class="code" href="a00102.html#a45351b06fc507c32c662d8b291888e4d" title="Menu text to display.">text</a>);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                <span class="keywordflow">case</span> KEY_LEFT:</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                    <a class="code" href="a01842.html#gaed0c7e19d4b54e566d4c78b0aa7d48c5" title="This will read the menu_items[] from the index requested.">read_menu</a>(menu.<a class="code" href="a00102.html#acce7c77dd74a7c6b859d97ee96167b4c" title="Contains next menu position for left.">left</a>);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                    <a class="code" href="a01842.html#gaa51c71cfcccf7560027214528bb7ceaf" title="This will put a string out to the LCD from Flash.">lcd_puts_P</a>(menu.<a class="code" href="a00102.html#a45351b06fc507c32c662d8b291888e4d" title="Menu text to display.">text</a>);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                <span class="keywordflow">case</span> KEY_RIGHT:</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                    <span class="comment">/*</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">                     * Check to see if we should show another menu or</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">                     * run a function</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">                     */</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                    <span class="keywordflow">if</span> (!menu.<a class="code" href="a00102.html#a7959396a1d97495660cbc200b0a2d982" title="Pointer to function to call when enter button is pressed.">enter_func</a>){</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                        <span class="comment">/* Just another menu to display */</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                        <a class="code" href="a01842.html#gaed0c7e19d4b54e566d4c78b0aa7d48c5" title="This will read the menu_items[] from the index requested.">read_menu</a>(menu.<a class="code" href="a00102.html#a0bca5d8294f06f38ad35b08b9866c2ab" title="Contains next menu position for right.">right</a>);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                        <a class="code" href="a01842.html#gaa51c71cfcccf7560027214528bb7ceaf" title="This will put a string out to the LCD from Flash.">lcd_puts_P</a>(menu.<a class="code" href="a00102.html#a45351b06fc507c32c662d8b291888e4d" title="Menu text to display.">text</a>);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                    }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                    <span class="comment">/* Drop through here */</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                <span class="keywordflow">case</span> KEY_ENTER:</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                    <span class="comment">/* Call the menu function on right or enter buttons */</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                    <span class="keywordflow">if</span> (menu.<a class="code" href="a00102.html#a7959396a1d97495660cbc200b0a2d982" title="Pointer to function to call when enter button is pressed.">enter_func</a>){</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                        menu.<a class="code" href="a00102.html#a7959396a1d97495660cbc200b0a2d982" title="Pointer to function to call when enter button is pressed.">enter_func</a>(menu.<a class="code" href="a00102.html#a4aad39b83ed8bbcb8834bf47d9fec201" title="State variable used as argument for menu enter function.">state</a>);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                        <span class="keywordflow">if</span> (menu.<a class="code" href="a00102.html#a4aad39b83ed8bbcb8834bf47d9fec201" title="State variable used as argument for menu enter function.">state</a>){</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                            <span class="comment">/*</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">                             * We just called a selection menu (not a test),</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">                             * so re-display the text for this menu level</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">                             */</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                            <a class="code" href="a01842.html#gaa51c71cfcccf7560027214528bb7ceaf" title="This will put a string out to the LCD from Flash.">lcd_puts_P</a>(menu.<a class="code" href="a00102.html#a45351b06fc507c32c662d8b291888e4d" title="Menu text to display.">text</a>);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                        }</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                        <span class="comment">/* After enter key, check the right button menu and display. */</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                        <a class="code" href="a01842.html#gaed0c7e19d4b54e566d4c78b0aa7d48c5" title="This will read the menu_items[] from the index requested.">read_menu</a>(menu.<a class="code" href="a00102.html#a0bca5d8294f06f38ad35b08b9866c2ab" title="Contains next menu position for right.">right</a>);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                        <a class="code" href="a01842.html#gaa51c71cfcccf7560027214528bb7ceaf" title="This will put a string out to the LCD from Flash.">lcd_puts_P</a>(menu.<a class="code" href="a00102.html#a45351b06fc507c32c662d8b291888e4d" title="Menu text to display.">text</a>);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                    }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <span class="comment">/* After button press, check for menus... */</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            <a class="code" href="a01842.html#ga394917f6adf383da5234e082473aeb97" title="This will check for the temp menu screen to determine if we need to clear the 4 digit LCD segments or...">check_menu</a>();</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="comment">/* Process any progress frames */</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <a class="code" href="a01842.html#ga848e02418f805237a2ffb57acc4330a6" title="This will receive a frame from the ATmega1284p and parse the incoming data.">uart_serial_rcv_frame</a>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    } <span class="comment">/* end for(). */</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;} <span class="comment">/* end main(). */</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">/** \} */</span></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 24 2014 16:26:15 for Contiki-Inga 3.x by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
